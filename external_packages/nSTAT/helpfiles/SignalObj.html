
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
      <!--
This HTML is auto-generated from an M-file.
To make changes, update the M-file and republish this document.
      -->
      <title>SignalObj</title>
      <meta name="generator" content="MATLAB 7.8">
      <meta name="date" content="2009-09-10">
      <meta name="m-file" content="SignalObj"><style type="text/css">

body {
  background-color: white;
  margin:10px;
}

h1 {
  color: #990000; 
  font-size: x-large;
}

h2 {
  color: #990000;
  font-size: medium;
}

/* Make the text shrink to fit narrow windows, but not stretch too far in 
wide windows. */ 
p,h1,h2,div.content div {
  max-width: 600px;
  /* Hack for IE6 */
  width: auto !important; width: 600px;
}

pre.codeinput {
  background: #EEEEEE;
  padding: 10px;
}
@media print {
  pre.codeinput {word-wrap:break-word; width:100%;}
} 

span.keyword {color: #0000FF}
span.comment {color: #228B22}
span.string {color: #A020F0}
span.untermstring {color: #B20000}
span.syscmd {color: #B28C00}

pre.codeoutput {
  color: #666666;
  padding: 10px;
}

pre.error {
  color: red;
}

p.footer {
  text-align: right;
  font-size: xx-small;
  font-weight: lighter;
  font-style: italic;
  color: gray;
}

  </style></head>
   <body>
      <div class="content"><pre class="codeinput"><span class="keyword">classdef</span> SignalObj &lt; handle
    <span class="comment">%SignalObj Class representing a signal abstraction</span>
    <span class="comment">%   SignalObj consist of data that is indexed by time (as a default). The</span>
    <span class="comment">%   indexing variable can be any other type of data and the x-axis labels</span>
    <span class="comment">%   modified to represent this change.</span>
    <span class="comment">%</span>
    <span class="comment">%   A SignalObj can be multivariate in that the data can have more than one component. The</span>
    <span class="comment">%   sample rate of the SignalObj is determined by the time increment used</span>
    <span class="comment">%   in the time sequence used when the SingalObj is created</span>
    <span class="comment">%</span>
    <span class="comment">%   Usage:</span>
    <span class="comment">%   &gt;&gt; s=SignalObj(time, data, name, xlabelval, xunits, yunits, dataLabels, plotProps)</span>
    <span class="comment">%</span>
    <span class="comment">%   Only time and data need to be specified. Other arguments are optional.</span>
    <span class="comment">%</span>
    <span class="comment">%</span>
    <span class="comment">%  time: indexing variable for the data. n x 1 or 1 x n array. The sample</span>
    <span class="comment">%        rate is determined by the time increment between samples of this vector. Units of</span>
    <span class="comment">%        [sec] are assumed, but need not be used. If the time vector is</span>
    <span class="comment">%        in units of [sec], the sampleRate is in units of [Hz]. If the</span>
    <span class="comment">%        time vector is in units of [msec] then the sampleRate is in</span>
    <span class="comment">%        units of [1/msec] or 10^3 [Hz].</span>
    <span class="comment">%</span>
    <span class="comment">%  data: n x m or m x n array reprenting the signal at each index of the time vector.</span>
    <span class="comment">%        The dimension that is compatible with the time vector will be automatically detected.</span>
    <span class="comment">%        Thus a SignalObj can be created by either passing the data matrix or its transpose. The remaining</span>
    <span class="comment">%        dimension will determine the dimensionality of the SignalObj.</span>
    <span class="comment">%</span>
    <span class="comment">%  name: string that determines the name of the signal. This is used to</span>
    <span class="comment">%        label the y-axis of the SignalObj.</span>
    <span class="comment">%</span>
    <span class="comment">%  xlabelval: A string specifying the name of the indexing variable. If</span>
    <span class="comment">%        this value is not specified, 'time' is used.</span>
    <span class="comment">%</span>
    <span class="comment">%  xunits: A string specifying the name of the units of the indexing</span>
    <span class="comment">%          variable. In not specified, 'sec' is used.</span>
    <span class="comment">%</span>
    <span class="comment">%  yunits: A string specifying the units of the SignalObj. Used when plotting the SignalObj.</span>
    <span class="comment">%</span>
    <span class="comment">%  dataLabels: If data is multivariate, the names of the components of the SignalObj can be specified.</span>
    <span class="comment">%              These can be used to reference specific data within the</span>
    <span class="comment">%              signal (e.g. the x-component of a 3-d vector) and are</span>
    <span class="comment">%              also used for plotting. SignalObj's will be created for</span>
    <span class="comment">%              each component of the orignal SignalObj under the</span>
    <span class="comment">%              vars field. Can be specified all at once or by a cell of</span>
    <span class="comment">%              strings.</span>
    <span class="comment">%</span>
    <span class="comment">%  plotProps:  Can be specified for each component of the SignalObj</span>
    <span class="comment">%              individually or by a cell of string of same dimension as the</span>
    <span class="comment">%              number of components in the data.</span>
    <span class="comment">%</span>
    <span class="comment">%</span>
    <span class="comment">%</span>
    <span class="comment">% &lt;a href="matlab:web(fullfile(strread(userpath,'%s','delimiter',';'),'Code Development','Signal','trunk','html','SignalObjExamples.html'))"&gt;SignalObj Examples&lt;/a&gt;</span>


    <span class="keyword">properties</span> (SetAccess = private)
        name       <span class="comment">% name of the SignalObj</span>
        time       <span class="comment">% time vector</span>
        data       <span class="comment">% actual SignalObj data</span>
        dimension  <span class="comment">% number of different components of the SignalObj</span>
        minTime    <span class="comment">% minimum Time value of the SignalObj</span>
        maxTime    <span class="comment">% maximum Time value of the SignalObj</span>
        xlabelval  <span class="comment">% label to use for the x-axis</span>
        xunits     <span class="comment">% units for x-axis</span>
        yunits     <span class="comment">% units for y-axis data</span>
        dataLabels <span class="comment">% labels for each dimension of the data;</span>
        dataMask   <span class="comment">% vector same length as SignalObj dimension. a 1 indicates this SignalObj should be output a 0 otherwie</span>
        sampleRate <span class="comment">% Hz if time is in seconds</span>
        plotProps  <span class="comment">% Plotting properties</span>
    <span class="keyword">end</span>
    <span class="keyword">properties</span> (Hidden)
        origSampleRate
        originalTime <span class="comment">%original timeVector</span>
        originalData <span class="comment">%original Data</span>
    <span class="keyword">end</span>
    <span class="keyword">properties</span> (Dependent = true)
        vars <span class="comment">%Contains subfields of the same names as the dataLabels that contain Signals with only the data corresponding to that label.</span>
    <span class="keyword">end</span>
    <span class="keyword">methods</span>
        <span class="comment">%Constructor</span>
        <span class="keyword">function</span> s=SignalObj(time, data, name, xlabelval, xunits, yunits, dataLabels, plotProps)

            <span class="keyword">if</span>(nargin&lt;6)
                yunits=<span class="string">''</span>;
            <span class="keyword">end</span>
            <span class="keyword">if</span>(nargin&lt;5)
                xunits=<span class="string">'s'</span>;
            <span class="keyword">end</span>
            <span class="keyword">if</span>(nargin&lt;4)
                xlabelval=<span class="string">'time'</span>;
            <span class="keyword">end</span>
            <span class="keyword">if</span>(nargin&lt;3)
                name=<span class="string">''</span>;
            <span class="keyword">end</span>
            [l,w]=size(time);
            <span class="keyword">if</span>(l&gt;=w);
                <span class="keyword">if</span>(w&gt;1)
                    error(<span class="string">'Time vector can only have one dimension'</span>);
                <span class="keyword">else</span>
                    s.time=time;

                <span class="keyword">end</span>
            <span class="keyword">elseif</span>(l&lt;=w)
                <span class="keyword">if</span>(l&gt;1)
                    error(<span class="string">'Time vector can only have one dimension'</span>);
                <span class="keyword">else</span>
                    s.time=time';
                <span class="keyword">end</span>
            <span class="keyword">end</span>
            s.originalTime=s.time;
            [l,w]=size(data);
           <span class="keyword">if</span>(l==length(s.time));
                s.data=data;
                s.dimension =w;
            <span class="keyword">elseif</span>(w==length(s.time));
                s.data=data';
                s.dimension=l;
           <span class="keyword">else</span>
               error(<span class="string">'Data dimensions do not match the time vector specified'</span>);
           <span class="keyword">end</span>
           s.originalData = s.data;
            <span class="keyword">if</span>(nargin &lt;7)
                <span class="keyword">for</span> i=1:s.dimension
                    dataLabels{i} = <span class="string">''</span>;
                <span class="keyword">end</span>
            <span class="keyword">end</span>
            s.dataMask  = ones(1,s.dimension);
            <span class="keyword">if</span>(nargin&lt;8)
                plotProps = cell(s.dimension,1);
            <span class="keyword">end</span>
            s.sampleRate = 1/mean(diff(s.time));
            s.origSampleRate = s.sampleRate;
            s.name=name;
            s.xlabelval=xlabelval;
            s.xunits=xunits;
            s.yunits=yunits;
            s.minTime=min(s.time);
            s.maxTime=max(s.time);
            s.setPlotProps(plotProps);
            s.setDataLabels(dataLabels);
        <span class="keyword">end</span>

        <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
        <span class="comment">%Set functions</span>
        <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
        <span class="keyword">function</span> setName(sObj,name) <span class="comment">%set the name after construction</span>
            <span class="keyword">if</span>(isa(name,<span class="string">'char'</span>))
                sObj.name = name;
            <span class="keyword">else</span>
                error(<span class="string">'Name must be a string!'</span>);
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">function</span> setXlabel(sObj,name)
            sObj.xlabelval = name;
        <span class="keyword">end</span>
        <span class="keyword">function</span> setYLabel(sObj,name)
            sObj.setName(name);
        <span class="keyword">end</span>
        <span class="keyword">function</span> setUnits(sObj, xUnits, yUnits)
            <span class="keyword">if</span>(nargin==3)
                <span class="keyword">if</span>(isa(yUnits,<span class="string">'char'</span>))
                    sObj.setYunits(yUnits);
                <span class="keyword">end</span>
            <span class="keyword">end</span>
            <span class="keyword">if</span>(nargin&gt;=2)
                <span class="keyword">if</span>(isa(xUnits,<span class="string">'char'</span>))
                    sObj.setXunits(xUnits);
                <span class="keyword">end</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">function</span> setXUnits(sObj, units)
            <span class="keyword">if</span>(isa(units, <span class="string">'char'</span>))
                sObj.xunits = units;
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">function</span> setYUnits(sObj, units)
            <span class="keyword">if</span>(isa(units,<span class="string">'char'</span>))
                sObj.yunits = units;
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">function</span> setSampleRate(sObj, sampleRate)
<span class="comment">%             sampleRate</span>
<span class="comment">%             sObj.sampleRate</span>
<span class="comment">%             ~(sampleRate==sObj.sampleRate)</span>
            <span class="keyword">if</span>(~(floor(sampleRate*100)/100==floor(sObj.sampleRate*100)/100)) <span class="comment">%Compare to 2 decimal places (finite precision has caused errors 500.000001 ~= 500.00000x</span>
                <span class="keyword">if</span>(sampleRate&gt;sObj.sampleRate)
                    <span class="comment">%fprintf(strcat('SignalObj,',sObj.name',', upsampled to:',num2str(sampleRate)));</span>
                <span class="keyword">else</span>
                    <span class="comment">%fprintf(strcat('SignalObj,',sObj.name',', downsampled to:',num2str(sampleRate)));</span>
                <span class="keyword">end</span>
                sObj.resampleMe(sampleRate);
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">function</span> setDataLabels(sObj,dataLabels)
            <span class="keyword">if</span>(isa(dataLabels,<span class="string">'char'</span>))
                <span class="keyword">if</span>(sObj.dimension==1)
                    sObj.dataLabels{1}=dataLabels;
                <span class="keyword">else</span>
                    error(<span class="string">'Adding single dataLabel to a SignalObj with more that 1 dimension'</span>);
                <span class="keyword">end</span>

            <span class="keyword">elseif</span>(isa(dataLabels,<span class="string">'cell'</span>))
                <span class="keyword">if</span>(length(dataLabels)==sObj.dimension)
                    ind=sObj.findIndFromDataMask;
                    <span class="keyword">for</span> i=ind
                        sObj.dataLabels{i} = dataLabels{i};
                    <span class="keyword">end</span>
                <span class="keyword">else</span>
                    error(<span class="string">'Need the number of labels to match the number of dimensions of the SignalObj'</span>);
                <span class="keyword">end</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">function</span> setMinTime(sObj,minTime,holdVals)
            <span class="keyword">if</span>(nargin&lt;3)
                holdVals=0;
            <span class="keyword">end</span>

            <span class="keyword">if</span>(nargin&lt;2)
                minTime=sObj.time(1);
            <span class="keyword">end</span>
            timeVec=sObj.getTime;
            <span class="keyword">if</span>(minTime&lt;min(timeVec))
                maxTime=max(timeVec);
                newTime=minTime:1/sObj.sampleRate:maxTime;
                numSamples = length(newTime)-length(timeVec);
                <span class="keyword">if</span>(holdVals==1)
                    newData=[ones(numSamples,1)*sObj.data(1,:);sObj.data];
                <span class="keyword">else</span>
                    newData=[zeros(numSamples,sObj.dimension);sObj.data];
                <span class="keyword">end</span>
                sObj.data=newData;
                sObj.time=newTime;
                sObj.minTime=min(sObj.time);
            <span class="keyword">elseif</span>(min(timeVec)==minTime)
                    <span class="comment">%do nothing</span>
            <span class="keyword">else</span>
                startIndex = sObj.findNearestTimeIndex(minTime);
                sObj.time=sObj.time(startIndex:end);
                sObj.data=sObj.data(startIndex:end,:);
            <span class="keyword">end</span>
            sObj.minTime=min(sObj.time);
        <span class="keyword">end</span>
        <span class="keyword">function</span> setMaxTime(sObj,maxTime, holdVals)
            <span class="keyword">if</span>(nargin&lt;3)
                holdVals=0;
            <span class="keyword">end</span>

            <span class="keyword">if</span>(nargin&lt;2)
                maxTime=sObj.time(end);
            <span class="keyword">end</span>
            timeVec=sObj.getTime;
            <span class="keyword">if</span>(max(timeVec)&lt;maxTime)
                minTime=min(timeVec);
                newTime=minTime:1/sObj.sampleRate:maxTime;
                numSamples = length(newTime)-length(timeVec);
                <span class="keyword">if</span>(holdVals==1)
                    newData=[sObj.data;ones(numSamples,1)*sObj.data(end,:)];
                <span class="keyword">else</span>
                    newData=[sObj.data;zeros(numSamples,sObj.dimension)];
                <span class="keyword">end</span>

                sObj.data=newData;
                sObj.time=newTime;
                sPnj.maxTime=max(sObj.time);
            <span class="keyword">elseif</span>(max(timeVec)==maxTime)
                    <span class="comment">%do nothing</span>

            <span class="keyword">else</span>
                endIndex = sObj.findNearestTimeIndex(maxTime);
                sObj.time=sObj.time(1:endIndex);
                sObj.data=sObj.data(1:endIndex,:);
            <span class="keyword">end</span>
            sObj.maxTime=max(sObj.time);
        <span class="keyword">end</span>
        <span class="keyword">function</span> setPlotProps(sObj, plotProps,index)
            <span class="keyword">if</span>(nargin&lt;=2)
                <span class="keyword">if</span>(isa(plotProps,<span class="string">'cell'</span>))
                    <span class="keyword">if</span>(length(plotProps) == sObj.dimension)
                        <span class="keyword">for</span> i=1:sObj.dimension
                            sObj.plotProps{i} = cell2str(plotProps{i});
                        <span class="keyword">end</span>
                    <span class="keyword">elseif</span>(length(plotProps)==1)
                        <span class="keyword">for</span> i=1:sObj.dimension
                            sObj.plotProps{i} = cell2str(plotProps);
                            display(<span class="string">'Index not specified. All dimensions set to have same plotting properties'</span>);
                        <span class="keyword">end</span>
                    <span class="keyword">else</span>
                        error(<span class="string">'Index not specified and more than 1 plotProp specified. Need to number of plotProps same as sObj.dimension or length 1'</span>);
                    <span class="keyword">end</span>
                <span class="keyword">elseif</span>(isa(plotProps,<span class="string">'char'</span>))
                     <span class="keyword">for</span> i=1:sObj.dimension
                        sObj.plotProps{i} = cell2str(plotProps);
                     <span class="keyword">end</span>
                     display(<span class="string">'All dimensions set to have same plotting properties'</span>)
                <span class="keyword">end</span>

            <span class="keyword">else</span>
                <span class="keyword">if</span>(isa(plotProps,<span class="string">'cell'</span>) &amp;&amp; length(plotProps)==1)
                    <span class="keyword">if</span>(index&gt;0 &amp;&amp; index&lt;=sObj.dimension)
                        sObj.plotProps{index} = plotProps{:};
                    <span class="keyword">else</span>
                        error(<span class="string">'Index out of bounds during setPlotProps'</span>);
                    <span class="keyword">end</span>
                <span class="keyword">elseif</span>(isa(plotProps,<span class="string">'char'</span>))
                     <span class="keyword">if</span>(index&gt;0 &amp;&amp; index&lt;=sObj.dimension)
                        sObj.plotProps{index} = plotProps;
                    <span class="keyword">else</span>
                        error(<span class="string">'Index out of bounds during setPlotProps'</span>);
                    <span class="keyword">end</span>

                <span class="keyword">end</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">function</span> setMask(sObj, mask)
            <span class="keyword">if</span>(nargin&lt;2)
                mask=zeros(1,sObj.dimension);
                sObj.setDataMask(mask);
                <span class="keyword">return</span>;
            <span class="keyword">end</span>
            <span class="comment">%mask is either a set of indices or names;</span>
            <span class="keyword">if</span>(isa(mask,<span class="string">'cell'</span>))
                <span class="keyword">if</span>(isa(mask{1},<span class="string">'char'</span>))
                    sObj.setMaskByLabels(mask);
                <span class="keyword">else</span>
                    error(<span class="string">'Mask cells must contains strings!'</span>);
                <span class="keyword">end</span>
            <span class="keyword">elseif</span>(isa(mask,<span class="string">'double'</span>))
                sObj.setMaskByInd(mask);
            <span class="keyword">else</span>
                error(<span class="string">'Can only set datamask with strings or indices'</span>)
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">function</span> setDataMask(sObj, dataMask)
        <span class="comment">%DataMasks affect how the SignalObj is visualized and converted to</span>
        <span class="comment">%other representations. It doesnt change the dimensions of the</span>
        <span class="comment">%object, nor does it delete data.</span>
            <span class="keyword">if</span>(length(dataMask)==sObj.dimension)
                  sObj.dataMask = dataMask;
            <span class="keyword">end</span>

        <span class="keyword">end</span>
        <span class="keyword">function</span> setMaskByInd(sObj,index)
            <span class="keyword">if</span>(length(index)==sObj.dimension)
                sObj.setDataMask(index);
            <span class="keyword">else</span>
                mask=zeros(1,sObj.dimension);
                mask(index)=1;
                sObj.setDataMask(mask);
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">function</span> setMaskByLabels(sObj,labels)
            ind=sObj.getIndicesFromLabels(labels);
            mask=zeros(1,sObj.dimension);
            mask(ind)=1;
            sObj.setDataMask(mask);
        <span class="keyword">end</span>

        <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
        <span class="keyword">function</span> tVec       = getTime(sObj)
            tVec=sObj.time;
        <span class="keyword">end</span>
        <span class="keyword">function</span> data       = getData(sObj)
            data=sObj.dataToMatrix;
        <span class="keyword">end</span>
        <span class="keyword">function</span> [t,d]      = getOriginalData(sObj)
            t=sObj.originalTime;
            d=sObj.originalData;
        <span class="keyword">end</span>
        <span class="keyword">function</span> s          = getOrigDataSig(sObj)
                [time,data]=sObj.getOriginalData;
                name=sObj.name;
                xlabelval=sObj.xlabelval;
                xunits=sObj.xunits;
                yunits=sObj.yunits;
                dataLabels=sObj.dataLabels;
                plotProps=sObj.plotProps;
                s = SignalObj(time, data,name, xlabelval, xunits, yunits,dataLabels,plotProps);
        <span class="keyword">end</span>
        <span class="keyword">function</span> index      = getIndexFromLabel(sObj,label)
            index=[];
            <span class="keyword">for</span> i=1:length(sObj.dataLabels)
                <span class="keyword">if</span>(strcmp(label, sObj.dataLabels{i}))
                    index = [index i];
                <span class="keyword">end</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">function</span> indices    = getIndicesFromLabels(sObj,label)
            <span class="comment">%Returns a cell array if the label appears for various point</span>
            <span class="comment">%int the SignalObj</span>
            <span class="comment">%Returns an array if the SignalObj label appears only once in the</span>
            <span class="comment">%SignalObj</span>
            <span class="keyword">if</span>(isa(label,<span class="string">'cell'</span>))
                indices =cell(1,length(label));
                numInd  =zeros(1,length(label));
                <span class="keyword">for</span> i=1:length(label)
                    tempInd = sObj.getIndexFromLabel(label{i});
                    <span class="keyword">if</span>(~isempty(tempInd))
                        numInd(i) = length(tempInd);
                        indices{i}=tempInd;
                    <span class="keyword">else</span>
                        error(<span class="string">'Label does not exist!'</span>);
                    <span class="keyword">end</span>

                <span class="keyword">end</span>
            <span class="keyword">elseif</span>(isa(label,<span class="string">'char'</span>))
                indices = getIndexFromLabel(label);
                numInd = length(indices);
            <span class="keyword">end</span>
            <span class="keyword">if</span>(max(numInd)==1)      <span class="comment">%For backwards compatibility if assuming only on index per label</span>
                <span class="keyword">for</span> i=1:length(label)
                    tempInd(i) = indices{i};
                <span class="keyword">end</span>
                indices = tempInd;
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">function</span> val        = getValueAt(sObj,x)
            ind=sObj.findNearestTimeIndex(x);
            val=sObj.data(ind,:);
        <span class="keyword">end</span>
        <span class="keyword">function</span> PropsStr   = getPlotProps(sObj,index)
            <span class="keyword">if</span>(index&gt;0 &amp;&amp; index&lt;=sObj.dimension)
                PropsStr = cell2str(sObj.plotProps{index});
            <span class="keyword">else</span>
                error(<span class="string">'index is out of bounds!'</span>);
            <span class="keyword">end</span>
        <span class="keyword">end</span>




        <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
        <span class="comment">% Operand Definitions and other mathematical operations</span>
        <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
        <span class="keyword">function</span> s3 = plus(s1,s2)
            <span class="keyword">if</span>(isa(s1,<span class="string">'SignalObj'</span>) &amp;&amp; isa(s2,<span class="string">'SignalObj'</span>))
                <span class="comment">% What is s2 is a constant or double?</span>
                <span class="keyword">if</span>(s1.dimension == s2.dimension)
                    [s1c,s2c] = makeCompatible(s1,s2);
                    s3=s1c.copySignal;
                    s3.data = s1c.data+s2c.data;

                    <span class="keyword">for</span> i=1:length(s3.dataLabels)
                        <span class="keyword">if</span>(strcmp(s2c.dataLabels{i}(1),<span class="string">'-'</span>))
                            s3.dataLabels{i} = [s1c.dataLabels{i} <span class="string">'-'</span> s2c.dataLabels{i}(2:end)];
                        <span class="keyword">else</span>
                            s3.dataLabels{i} = [s1c.dataLabels{i} <span class="string">'+'</span> s2c.dataLabels{i}];
                        <span class="keyword">end</span>
                    <span class="keyword">end</span>
                <span class="keyword">else</span>
                    error(<span class="string">'Can only add signals if they have the same dimension'</span>);
                <span class="keyword">end</span>
            <span class="keyword">elseif</span>(isa(s1,<span class="string">'double'</span>) || isa(s2,<span class="string">'double'</span>))
                <span class="keyword">if</span>(isa(s1,<span class="string">'double'</span>))
                  s3=s2.copySignal;
                  [l,w] = size(s1);
                  <span class="keyword">if</span>(w==s3.dimension &amp;&amp; l==1)
                      s3.data = s3.data+ones(length(s3.data),1)*s1;
                      <span class="keyword">for</span> i=1:length(s3.dataLabels)
                            <span class="keyword">if</span>(sign(s1(i))==-1)
                                s3.dataLabels{i} = [s2.dataLabels{i} <span class="string">'-'</span> num2str(abs(s1(i)))];
                            <span class="keyword">else</span>
                                s3.dataLabels{i} = [s2.dataLabels{i} <span class="string">'+'</span> num2str(abs(s1(i)))];
                            <span class="keyword">end</span>
                      <span class="keyword">end</span>
                  <span class="keyword">else</span>
                      s3.data = s3.data+s1;
                      <span class="comment">%dont modify dataLabels since s1 is a matrix;</span>

                      <span class="comment">%for i=1:length(s3.dataLabels)</span>
                      <span class="comment">%      s3.dataLabels{i} = [s2.dataLabels{i} '+' num2str(s1(i))];</span>
                      <span class="comment">%end</span>
                  <span class="keyword">end</span>
                <span class="keyword">else</span>
                  s3=s1.copySignal;
                  [l,w] = size(s2);
                  <span class="comment">%size(s3.data)</span>
                  <span class="keyword">if</span>(w==s3.dimension &amp;&amp; l==1)
                      s3.data = s3.data+ones(length(s3.data),1)*s2;
                      <span class="keyword">for</span> i=1:length(s3.dataLabels)
                            <span class="keyword">if</span>(sign(s2(i))==-1)
                                s3.dataLabels{i} = [s1.dataLabels{i} <span class="string">'-'</span> num2str(abs(s2(i)))];
                            <span class="keyword">else</span>
                                s3.dataLabels{i} = [s1.dataLabels{i} <span class="string">'+'</span> num2str(abs(s2(i)))];
                            <span class="keyword">end</span>
                      <span class="keyword">end</span>
                  <span class="keyword">else</span>

                      s3.data = s3.data+s2;
                      <span class="comment">%dont modify dataLabels since s2 is a matrix;</span>
                      <span class="comment">%for i=1:length(s3.dataLabels)</span>
                      <span class="comment">%      s3.dataLabels{i} = [s1.dataLabels{i} '+' num2str(s2)];</span>
                      <span class="comment">%end</span>
                  <span class="keyword">end</span>
                <span class="keyword">end</span>
            <span class="keyword">else</span>
                error(<span class="string">'only Signals or doubles are currently supported'</span>);
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">function</span> s3 = minus(s1,s2)
            s3=plus(s1,-s2);
        <span class="keyword">end</span>
        <span class="keyword">function</span> s3 = uplus(s1) <span class="comment">%+s1</span>
            s3=s1.copySignal;
        <span class="keyword">end</span>
        <span class="keyword">function</span> s3 = uminus(s1) <span class="comment">%-s1</span>

            s3=s1.copySignal;
            s3.data=-s3.data;
            <span class="keyword">for</span> i=1:length(s3.dataLabels)
                s3.dataLabels{i} = strcat(<span class="string">'-'</span>,s1.dataLabels{i});
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">function</span> s3 = times(s1,s2) <span class="comment">%s1.*s2</span>
            <span class="keyword">if</span>(isa(s1,<span class="string">'SignalObj'</span>) &amp;&amp; isa(s2,<span class="string">'SignalObj'</span>))
               <span class="keyword">if</span>(s1.dimension == s2.dimension)
                   [s1c,s2c] = makeCompatible(s1,s2);
                   s3 = s1c;
                   s3.data = s1c.data.*s2c.data;
                   <span class="comment">%can multiply units</span>
               <span class="keyword">else</span>
                   error(<span class="string">'can only multiply signals with same dimension'</span>);
               <span class="keyword">end</span>
            <span class="keyword">elseif</span>(isa(s1,<span class="string">'double'</span>) || isa(s2,<span class="string">'double'</span>))
                <span class="keyword">if</span>(isa(s1,<span class="string">'double'</span>))
                  s3=s2.copySignal;
                  [l,w] = size(s1);
                  <span class="keyword">if</span>(w==s3.dimension &amp;&amp; l==1)
                      s3.data = s3.data.*(ones(length(s3.data),1)*s1);
                  <span class="keyword">else</span>
                      s3.data = s3.data.*s1;
                  <span class="keyword">end</span>
                <span class="keyword">else</span>
                  s3=s1.copySignal;
                  [l,w] = size(s2);
                  <span class="keyword">if</span>(w==s3.dimension &amp;&amp; l==1)
                      s3.data = s3.data.*(ones(length(s3.data),1)*s2);
                  <span class="keyword">else</span>
                      s3.data = s3.data.*s2;
                  <span class="keyword">end</span>
                <span class="keyword">end</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">function</span> s3 = mtimes(s1,s2) <span class="comment">%s1*s2</span>
            <span class="keyword">if</span>(isa(s1,<span class="string">'SignalObj'</span>) &amp;&amp; isa(s2,<span class="string">'SignalObj'</span>))
                   <span class="comment">%[s1c,s2c] = makeCompatible(s1,s2);</span>
                   s3 = s1.copySignal;
                   s3.data = s1.data.*s2.data;
                   <span class="comment">%can multiply units</span>
           <span class="keyword">elseif</span>(isa(s1,<span class="string">'double'</span>) || isa(s2,<span class="string">'double'</span>))
                <span class="keyword">if</span>(isa(s1,<span class="string">'double'</span>))
                  s3=s2.copySignal;
                  s3.data = (s1*s3.data')';
                <span class="keyword">else</span>
                  s3=s1.copySignal;
                  s3.data = (s3.data'*s2)';
                <span class="keyword">end</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">function</span> s3 = rdivide(s1,s2)
            <span class="keyword">if</span>(isa(s1,<span class="string">'SignalObj'</span>) &amp;&amp; isa(s2,<span class="string">'SignalObj'</span>))
               <span class="keyword">if</span>(s1.dimension == s2.dimension)
                   [s1c,s2c] = makeCompatible(s1,s2);
                   s3 = s1c;
                   s3.data = s1c.data./s2c.data;
                   <span class="comment">%can multiply units</span>
               <span class="keyword">else</span>
                   error(<span class="string">'can only multiply signals with same dimension'</span>);
               <span class="keyword">end</span>
            <span class="keyword">elseif</span>(isa(s1,<span class="string">'double'</span>) || isa(s2,<span class="string">'double'</span>))
                <span class="keyword">if</span>(isa(s1,<span class="string">'double'</span>))
                  s3=s2.copySignal;
                  s3.data = s1./s3.data;
                <span class="keyword">else</span>
                  s3=s1.copySignal;
                  s3.data = s3.data./s2;
                <span class="keyword">end</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">function</span> s3 = ldivide(s1,s2)
            <span class="keyword">if</span>(isa(s1,<span class="string">'SignalObj'</span>) &amp;&amp; isa(s2,<span class="string">'SignalObj'</span>))
               <span class="keyword">if</span>(s1.dimension == s2.dimension)
                   [s1c,s2c] = makeCompatible(s1,s2);
                   s3 = s1c;
                   s3.data = s1c.data.\s2c.data;
                   <span class="comment">%can multiply units</span>
               <span class="keyword">else</span>
                   error(<span class="string">'can only multiply signals with same dimension'</span>);
               <span class="keyword">end</span>
            <span class="keyword">elseif</span>(isa(s1,<span class="string">'double'</span>) || isa(s2,<span class="string">'double'</span>))
                <span class="keyword">if</span>(isa(s1,<span class="string">'double'</span>))
                  s3=s2.copySignal;
                  s3.data = s1.\s3.data;
                <span class="keyword">else</span>
                  s3=s1.copySignal;
                  s3.data = s3.data.\s2;
                <span class="keyword">end</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">function</span> s3 = ctranspose(s1)
            s3=s1.copySignal;
            s3.data=s3.data.';
            [l,w]=size(s3.data);
            s3.dimension=w;
        <span class="keyword">end</span>
        <span class="keyword">function</span> s3 = transpose(s1)
            s3=s1.copySignal;
            s3.data=s3.data.';
            [l,w]=size(s3.data);
            s3.dimension=w;
        <span class="keyword">end</span>
        <span class="keyword">function</span> s3 = derivative(sObj)
<span class="comment">%             B=[1 -1]*sObj.sampleRate;</span>
<span class="comment">%             A=1;</span>
<span class="comment">%             s3=sObj.filter(B,A);</span>
            s3=sObj.copySignal;
            tData=diff(s3.data)*s3.sampleRate;
            tData=[zeros(1,s3.dimension); tData];
            s3.data=tData;

            s3.setYUnits(strcat(<span class="string">'\frac{'</span>,s3.yunits,<span class="string">'}{'</span>,s3.xunits,<span class="string">'}'</span>));
            denomstr = strcat(<span class="string">'d'</span>, s3.xlabelval(1));

            s3.setName(strcat(<span class="string">'\frac{d}{'</span>,denomstr,<span class="string">'}'</span>,s3.name));
            <span class="keyword">for</span> i=1:s3.dimension
                <span class="keyword">if</span>(~strcmp(sObj.dataLabels{i},<span class="string">''</span>))
                    s3.dataLabels{i}= strcat(<span class="string">'\frac{d}{'</span>,denomstr,<span class="string">'}'</span>,s3.dataLabels{i});
                <span class="keyword">end</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">function</span> val = derivativeAt(sObj,x0)
            sTemp = sObj.derivative;
            val = sTemp.getValueAt(x0);
        <span class="keyword">end</span>
        <span class="keyword">function</span> s3 = integral(sObj,t0,tf)
            <span class="keyword">if</span>(nargin&lt;3)
                tf=sObj.maxTime;
            <span class="keyword">end</span>
            <span class="keyword">if</span>(nargin&lt;2)
                t0=sObj.minTime;
            <span class="keyword">end</span>

            <span class="comment">%y[n] = y[n-1] + x[n]*deltaT</span>
            B=1*1/sObj.sampleRate;
            A=[1 -1];
            s3=sObj.getSigInTimeWindow(t0,tf);
            s3=s3.filter(B,A);
            s3.setYUnits(strcat(s3.yunits,<span class="string">'*'</span>,s3.xunits));
            dtstr = strcat(<span class="string">' d'</span>,<span class="string">'\tau'</span>);
            s3.setName([<span class="string">'\int_'</span>,num2str(s3.minTime),<span class="string">'^'</span>,s3.xlabelval(1),<span class="string">'\!\!{'</span>,[s3.name dtstr],<span class="string">'}'</span>]);
            <span class="keyword">for</span> i=1:s3.dimension
                <span class="keyword">if</span>(~strcmp(sObj.dataLabels{i},<span class="string">''</span>))
                    s3.dataLabels{i}= [<span class="string">'\int_'</span>,num2str(s3.minTime),<span class="string">'^'</span>,s3.xlabelval(1),<span class="string">'\!\!{'</span>,[s3.dataLabels{i} dtstr],<span class="string">'}'</span>];
                <span class="keyword">end</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">function</span> s3 = filter(sObj, B,A)
            s3=sObj.copySignal;
            s3.data = filter(B,A,s3.data);
        <span class="keyword">end</span>
        <span class="keyword">function</span> s3 = filtfilt(sObj,B,A)
            s3=sObj.copySignal;
            s3.data = filtfilt(B,A,s3.data);
        <span class="keyword">end</span>
        <span class="keyword">function</span> [s1c,s2c] = makeCompatible(s1,s2,holdVals)
            <span class="keyword">if</span>(nargin&lt;3)
                holdVals=0;
            <span class="keyword">end</span>
            s1c = s1.copySignal; s2c = s2.copySignal;
            minTime=min(s1c.minTime,s2c.minTime);
            maxTime=max(s1c.maxTime,s2c.maxTime);
            sampleRate=max(s1c.sampleRate,s2c.sampleRate);
            s1c.setSampleRate(sampleRate); s2c.setSampleRate(sampleRate);
            s1c.setMinTime(minTime,holdVals);       s2c.setMinTime(minTime,holdVals);
            s1c.setMaxTime(maxTime,holdVals);       s2c.setMaxTime(maxTime,holdVals);

            <span class="comment">%pause</span>
<span class="comment">%             for i=1:s2c.dimension</span>
             data = spline(s2c.time,s2c.data',s1c.time);
<span class="comment">%             end</span>
             s2c.time = s1c.time;
             [nrows,ncolumns] = size(data);
             <span class="keyword">if</span>(nrows&gt;ncolumns)
                s2c.data = data;
             <span class="keyword">else</span>
                s2c.data = data';
             <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">function</span> m=mean(sObj,varargin)
            mdata=mean(sObj.data,varargin{:});
            [nrows,ncolumns]=size(mdata);
            <span class="keyword">if</span>( (nrows==length(sObj.time)) &amp;&amp; (ncolumns==1) ) <span class="comment">%mean across dimensions</span>
                m=SignalObj(sObj.time, mdata, [<span class="string">'Mean of '</span> sObj.name],sObj.xlabelval, sObj.xunits,sObj.yunits);
            <span class="keyword">elseif</span>( (nrows==1) &amp;&amp; (ncolumns == sObj.dimension) )  <span class="comment">%mean of each dimension</span>
                <span class="keyword">if</span>(~sObj.areDataLabelsEmpty)
                    dataLabels = cell(size(sObj.dataLabels));
                    <span class="keyword">for</span> i=1:sObj.dimension
                        dataLabels{i} = strcat(<span class="string">'\mu('</span>,sObj.dataLabels{i},<span class="string">')'</span>);
                    <span class="keyword">end</span>
                     m=SignalObj([sObj.time(1); sObj.time(end)], [mdata;mdata], [<span class="string">'Mean of '</span> sObj.name],sObj.xlabelval, sObj.xunits,sObj.yunits,dataLabels);
                <span class="keyword">else</span>
                    m=SignalObj([sObj.time(1); sObj.time(end)], [mdata;mdata],  [<span class="string">'Mean of '</span> sObj.name],sObj.xlabelval, sObj.xunits,sObj.yunits);
                <span class="keyword">end</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">function</span> m=max(sObj,varargin)
            m=max(sObj.data,varargin{:});
        <span class="keyword">end</span>
        <span class="keyword">function</span> m=min(sObj,varargin)
            m=min(sObj.data,varargin{:});
        <span class="keyword">end</span>
        <span class="keyword">function</span> periodogram = periodogram(sObj)
            fs = sObj.sampleRate;  <span class="comment">% Sampling frequency</span>
            periodogram = cell(1,sObj.dimension);
            <span class="keyword">for</span> i=1:sObj.dimension
                xn = sObj.data(:,i);
                Hs = spectrum.periodogram(<span class="string">'rectangular'</span>);
                <span class="keyword">switch</span> sObj.dimension
                    <span class="keyword">case</span> 2
                        subplot(1,2,i)
                    <span class="keyword">case</span> 3
                        subplot(1,3,i)
                    <span class="keyword">case</span> 4
                        subplot(2,2,i)
                    <span class="keyword">case</span> 5
                        subplot(3,2,i)
                    <span class="keyword">case</span> 6
                        subplot(3,2,i)
                    <span class="keyword">otherwise</span>
                         h=gcf;figure(h);
                <span class="keyword">end</span>
                periodogram{i}=psd(Hs,xn,<span class="string">'Fs'</span>,fs,<span class="string">'NFFT'</span>,1024);
                h=periodogram{i}.plot;legend(h, sObj.dataLabels{i});
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">function</span> mtmSpec = MTMspectrum(sObj,NW,NFFT,Pval)
            <span class="keyword">if</span>(nargin&lt;4)
                Pval=.95;
            <span class="keyword">end</span>
            <span class="keyword">if</span>(nargin&lt;3)
                NFFT=[];
            <span class="keyword">end</span>
            <span class="keyword">if</span>(nargin&lt;2)
                NW=4;
            <span class="keyword">end</span>

            Fs=sObj.sampleRate;
            mtmSpec = cell(1,sObj.dimension);
            <span class="keyword">for</span> i=1:sObj.dimension
                xn=sObj.data(:,i);
                [Pxx,Pxxc,f] = pmtm(xn,NW,NFFT,Fs,Pval);
                hpsd = dspdata.psd([Pxx Pxxc],<span class="string">'Fs'</span>,Fs);
                mtmSpec{i} = hpsd;
                <span class="keyword">switch</span> sObj.dimension
                    <span class="keyword">case</span> 2
                        subplot(1,2,i)
                    <span class="keyword">case</span> 3
                        subplot(1,3,i)
                    <span class="keyword">case</span> 4
                        subplot(2,2,i)
                    <span class="keyword">case</span> 5
                        subplot(3,2,i)
                    <span class="keyword">case</span> 6
                        subplot(3,2,i)
                    <span class="keyword">otherwise</span>
                         h=gcf;figure(h);
                <span class="keyword">end</span>
                str1=strcat(num2str(Pval*100), <span class="string">'% Conf. Int.'</span>);
                h=plot(hpsd); legend(h, sObj.dataLabels{i},strcat(<span class="string">'-'</span>,str1),strcat(<span class="string">'+'</span>,str1));
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
        <span class="comment">%Utility Functions</span>
        <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
        <span class="keyword">function</span> mergedSig = merge(sObj,varargin)
            numToMerge=0;
            holdVals=0;
            <span class="keyword">for</span> i=1:length(varargin)
                <span class="keyword">if</span>(isa(varargin{i},<span class="string">'SignalObj'</span>))
                    numToMerge = numToMerge+1;
                <span class="keyword">end</span>
                <span class="keyword">if</span>(isa(varargin{i},<span class="string">'double'</span>)&amp;&amp;i==length(varargin)) <span class="comment">%expect only one double at the end</span>
                    holdVals = varargin{i};
                <span class="keyword">end</span>
            <span class="keyword">end</span>

            <span class="keyword">if</span>(numToMerge == 1)
                [s1c, s2c] = sObj.makeCompatible(varargin{1},holdVals);
                 data=[s1c.dataToMatrix, s2c.dataToMatrix];
                 dataLabels = cell(s1c.dimension+s2c.dimension,1);
                 <span class="keyword">for</span> i=1:s1c.dimension
                        dataLabels{i} = s1c.dataLabels{i};
                 <span class="keyword">end</span>
                 <span class="keyword">for</span> i=1:s2c.dimension
                        dataLabels{s1c.dimension+i}=s2c.dataLabels{i};
                 <span class="keyword">end</span>
                 name = [s1c.name, <span class="string">','</span>, s2c.name];
                 mergedSig = SignalObj(s1c.time, data, name, s1c.xlabelval,s1c.xunits, s1c.yunits, dataLabels);
            <span class="keyword">else</span>
                  mergedSig = sObj.merge(varargin{1},holdVals);
                  <span class="keyword">for</span> i=2:numToMerge
                        mergedSig = mergedSig.merge(varargin{i},holdVals);
                  <span class="keyword">end</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">function</span> sigOut=copySignal(sigIn)
                time=sigIn.time;
                data=sigIn.data;
                name=sigIn.name;
                xlabelval=sigIn.xlabelval;
                xunits=sigIn.xunits;
                yunits=sigIn.yunits;
                dataLabels=sigIn.dataLabels;
                plotProps=sigIn.plotProps;
                sigOut = SignalObj(time, data,name, xlabelval, xunits, yunits,dataLabels,plotProps);
                sigOut.dataMask = sigIn.dataMask;
        <span class="keyword">end</span>
        <span class="keyword">function</span> sObjOut=resample(sObj, newSampleRate)
            sObjOut = sObj.copySignal;
            sObjOut.resampleMe(newSampleRate);
        <span class="keyword">end</span>
        <span class="keyword">function</span> resampleMe(sObj, newSampleRate)
            sObj.restoreToOriginal; <span class="comment">%use default data for changing samplerate</span>
            <span class="comment">%Change the sampling rate of this object</span>
            minTime=sObj.minTime;
            maxTime=sObj.maxTime;
            newTime=minTime:1/newSampleRate:maxTime;
            newData=zeros(length(newTime),sObj.dimension);
            <span class="keyword">for</span> i=1:sObj.dimension
                newData(:,i)= spline(sObj.time,sObj.data(:,i),newTime);
            <span class="keyword">end</span>
                sObj.time=newTime;
                sObj.data=newData;
                sObj.sampleRate=newSampleRate;
        <span class="keyword">end</span>
        <span class="keyword">function</span> restoreToOriginal(sObj,rMask)
            <span class="keyword">if</span>(nargin&lt;2)
              rMask = 0; <span class="comment">%keep mask even when data reset</span>
            <span class="keyword">end</span>
             [time,data]=sObj.getOriginalData;
             sObj.time=time;
             sObj.data=data;
             sObj.minTime=min(time);
             sObj.maxTime=max(time);
             sObj.sampleRate = 1/mean(diff(time));
             <span class="keyword">if</span>(rMask==1)
                 sObj.resetMask;
             <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">function</span> resetMask(sObj)
            sObj.dataMask = ones(1,sObj.dimension);
        <span class="keyword">end</span>
        <span class="keyword">function</span> ind = findIndFromDataMask(sObj)
            ind = find(sObj.dataMask ==1);
<span class="comment">%             if(isempty(ind))</span>
<span class="comment">%                 error('All data masked out of SignalObj');</span>
<span class="comment">%             end</span>
        <span class="keyword">end</span>
        <span class="keyword">function</span> ind=findNearestTimeIndex(sObj, time)
            <span class="keyword">if</span>(time&lt;sObj.minTime)
                ind=1;
            <span class="keyword">elseif</span>(time&gt;sObj.maxTime)
                ind=length(sObj.time);
            <span class="keyword">else</span>
                ind1=find(sObj.time&gt;=time,1,<span class="string">'first'</span>);
                ind2=find(sObj.time&lt;=time,1,<span class="string">'last'</span>);
                <span class="keyword">if</span>(abs(sObj.time(ind1)-time)&lt;=abs(sObj.time(ind2)-time))
                    ind=ind1;
                <span class="keyword">else</span>
                    ind=ind2;
                <span class="keyword">end</span>
<span class="comment">%                 if(time-sObj.minTime &lt; sObj.maxTime-time) %Time is close to beginning</span>
<span class="comment">%                     ind=min([ind1, ind2]);</span>
<span class="comment">%                 else</span>
<span class="comment">%                     ind=max([ind1, ind2]);</span>
<span class="comment">%                 end</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">function</span> sOut = shift(sObj, deltaT)

            <span class="comment">%returns s shift by deltaT. If deltaT is positive</span>
            <span class="comment">%the SignalObj is moved deltaT time steps forward</span>
            <span class="comment">%if deltaT is negative, the SignalObj is moved deltaT units</span>
            <span class="comment">%backwards.</span>
            <span class="comment">%compute number of samples delayed</span>
            sOut=sObj.copySignal;
            newMinTime = sOut.minTime+deltaT;
            newMaxTime = sOut.maxTime+deltaT;
            newTime=newMinTime:1/sOut.sampleRate:newMaxTime;
            sOut.time = newTime;
            sOut.minTime = newMinTime;
            sOut.maxTime = newMaxTime;
        <span class="keyword">end</span>
        <span class="keyword">function</span> shiftMe(sObj,deltaT)
            sTemp = sObj.shift(deltaT);
            sObj.data=sTemp.data;
            sObj.time=sTemp.time;
        <span class="keyword">end</span>
        <span class="keyword">function</span> alignTime(sObj, timeMarker,newTime)
            <span class="keyword">if</span>(sObj.minTime&lt;=timeMarker &amp;&amp; sObj.maxTime&gt;=timeMarker)
                deltaT=newTime-timeMarker;
                sObj.shiftMe(deltaT);
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">function</span> answer = plotPropsSet(sObj)
            answer =0;
            <span class="keyword">for</span> i=1:sObj.dimension
                <span class="keyword">if</span>(~strcmp(sObj.getPlotProps(i),<span class="string">''</span>))
                    answer=1;
                    <span class="keyword">break</span>;
                <span class="keyword">end</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">function</span> answer = areDataLabelsEmpty(sObj)
            answer = 1;
            <span class="keyword">for</span> i=1:length(sObj.dataLabels);
                <span class="keyword">if</span>(~strcmp(sObj.dataLabels{i},<span class="string">''</span>))
                    answer = 0;
                    <span class="keyword">break</span>;
                <span class="keyword">end</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">function</span> answer = isLabelPresent(sObj, label)
            <span class="keyword">if</span>(isa(label,<span class="string">'char'</span>))
                <span class="keyword">if</span>(strcmp(label,<span class="string">'all'</span>)||~isempty(sObj.getIndexFromLabel(label)))
                    answer=1;
                <span class="keyword">else</span>
                    answer=0;
                <span class="keyword">end</span>
            <span class="keyword">else</span>
                error(<span class="string">'Labels must be a char'</span>);
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">function</span> answer = isMaskSet(sObj)
            answer=~isempty(sObj.dataMask==0);
        <span class="keyword">end</span>
        <span class="keyword">function</span> sArray = convertNamesToIndices(sObj, selectorArray)
            <span class="keyword">if</span>(sObj.areDataLabelsEmpty)
                sArray = 1:sObj.dimension; <span class="comment">% Return all the data;</span>
                fprintf(<span class="string">'tried to find data by labels but data doesnot have labels assigned'</span>);
            <span class="keyword">else</span>
                <span class="keyword">if</span>(isa(selectorArray, <span class="string">'char'</span>))
                    <span class="keyword">if</span>(strcmp(selectorArray,<span class="string">'all'</span>))
                        sArray=1:sObj.dimension;
                    <span class="keyword">elseif</span>(sObj.isLabelPresent(selectorArray))
                        sArray=sObj.getIndexFromLabel(selectorArray);
                    <span class="keyword">else</span>
                        error(<span class="string">'Specified label does not match data label'</span>);
                    <span class="keyword">end</span>

                <span class="keyword">elseif</span>(isa(selectorArray, <span class="string">'double'</span>))
                    sArray=selectorArray;
                <span class="keyword">elseif</span>(isa(selectorArray, <span class="string">'cell'</span>))
                    sArray = zeros(1, length(selectorArray));
                    <span class="keyword">for</span> i=1:length(sArray)
                        <span class="keyword">if</span>(sObj.isLabelPresent(selectorArray{i}))
                            sArray(i) = sObj.getIndexFromLabel(selectorArray{i});
                        <span class="keyword">end</span>
                    <span class="keyword">end</span>
                <span class="keyword">else</span>
                    error(<span class="string">'selectorArray cells must contain text'</span>);
                <span class="keyword">end</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">function</span> [indices, values] = findPeaks(sObj,type)
            <span class="keyword">if</span>(nargin&lt;2)
                type=<span class="string">'maxima'</span>;
            <span class="keyword">end</span>
            values=cell(1,sObj.dimension);
            indices=cell(1,sObj.dimension);
            <span class="keyword">if</span>(strcmp(type,<span class="string">'maxima'</span>))
                <span class="keyword">for</span> i=1:w
                    [values{i},indices{i}] = findPeaks(sObj.data(:,i));
                <span class="keyword">end</span>
            <span class="keyword">elseif</span>(strcmp(type,<span class="string">'minima'</span>))
                <span class="keyword">for</span> i=1:w
                    [values{i},indices{i}] = findPeaks(sObj.data(:,i));
                <span class="keyword">end</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">function</span> [indices, values] = findMaxima(sObj)
            [indices,values]=sObj.findPeaks(<span class="string">'maxima'</span>);
        <span class="keyword">end</span>
        <span class="keyword">function</span> [indices, values] = findMinima(sObj)
            [indices,times,values]= sObj.findPeaks(<span class="string">'minima'</span>);
        <span class="keyword">end</span>
        <span class="keyword">function</span> clearPlotProps(sObj,index)
            <span class="keyword">if</span>(nargin&lt;2)
                index=1:sObj.dimension;
            <span class="keyword">end</span>
            tempCell = cell(length(index),1);
            <span class="keyword">for</span> i=index
                sObj.plotProps{i} = cell2str(tempCell{i});
            <span class="keyword">end</span>

        <span class="keyword">end</span>
        <span class="keyword">function</span> v=get.vars(sObj)
            <span class="keyword">if</span>(~sObj.areDataLabelsEmpty)
                UniqueSigLabels = unique(sObj.dataLabels);

                <span class="keyword">for</span> i=1:length(UniqueSigLabels)
                    eval(strcat(<span class="string">'v.('''</span>,UniqueSigLabels{i},<span class="string">''')=sObj.getSubSignal('''</span>,UniqueSigLabels{i},<span class="string">''');'</span>));
                <span class="keyword">end</span>
            <span class="comment">%sObj.vars=v;</span>
            <span class="keyword">else</span>
                <span class="keyword">for</span> i=1:sObj.dimension

                    eval(strcat(<span class="string">'v.('''</span>,sObj.dataLabels{i},<span class="string">''')=sObj.getSubSignal(i);'</span>))
                <span class="keyword">end</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
        <span class="comment">%Change of Representation Functions</span>
        <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
        <span class="keyword">function</span> structure=dataToStructure(sObj,selectorArray)
            <span class="keyword">if</span>(nargin&lt;2)
                <span class="keyword">if</span>(sObj.isMaskSet)
                    selectorArray=sObj.findIndFromDataMask;
                <span class="keyword">else</span>
                    selectorArray=1:sObj.dimension;
                <span class="keyword">end</span>
            <span class="keyword">end</span>
            <span class="comment">%Convert to a standard matlab structure</span>
            structure.time=sObj.time;
            structure.signals.values=sObj.dataToMatrix(selectorArray);
        <span class="keyword">end</span>
        <span class="keyword">function</span> dataMat=dataToMatrix(sObj,selectorArray)
            <span class="keyword">if</span>(nargin&lt;2)
                <span class="keyword">if</span>(sObj.isMaskSet)
                    selectorArray=sObj.findIndFromDataMask;
                <span class="keyword">else</span>
                    selectorArray=1:sObj.dimension;
                <span class="keyword">end</span>
            <span class="keyword">end</span>
            <span class="comment">% Convert data to a standard matrix.</span>
            <span class="comment">% The matrix is length(times)x dimension</span>
            dataMat=sObj.data(:,selectorArray);
        <span class="keyword">end</span>
        <span class="keyword">function</span> sOut = getSubSignal(sObj,identifier)
            <span class="keyword">if</span>(isa(identifier,<span class="string">'cell'</span>))
                <span class="keyword">if</span>(isa(identifier{1},<span class="string">'char'</span>))
                    sOut = sObj.getSubSignalFromNames(identifier);
                <span class="keyword">elseif</span>(isa(identifier{1},<span class="string">'double'</span>))
                    sOut = sObj.getSubSignalFromInd(identifier);
                <span class="keyword">else</span>
                    error(<span class="string">'Cells must contain strings!'</span>);
                <span class="keyword">end</span>
            <span class="keyword">elseif</span>(isa(identifier,<span class="string">'double'</span>))
                sOut = sObj.getSubSignalFromInd(identifier);
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">function</span> wSignal = getSigInTimeWindow(sObj,wMin,wMax)
            wSignal = sObj.copySignal;
            <span class="keyword">if</span>(wMin&lt;wSignal.minTime)
                <span class="comment">%if the window starts before the SignalObj pad with zeros</span>
                <span class="comment">%and set as new starttime</span>
                wSignal.setMinTime(wMin);
            <span class="keyword">end</span>
            <span class="keyword">if</span>(wMax&gt;wSignal.maxTime)
                <span class="comment">%if wMax is too big, pad with zeros at end and set as new</span>
                <span class="comment">%end</span>
                wSignal.setMaxTime(wMax);
            <span class="keyword">end</span>

            startIndex= wSignal.findNearestTimeIndex(wMin);
            endIndex  = wSignal.findNearestTimeIndex(wMax);
            wSignal.time=wSignal.time(startIndex:endIndex); wSignal.data=wSignal.data(startIndex:endIndex,:);
            wSignal.setMinTime;
            wSignal.setMaxTime;
        <span class="keyword">end</span>
        <span class="keyword">function</span> sOut = getSubSignalFromInd(sObj, selectorArray)
            <span class="keyword">if</span>(nargin&lt;2)
                <span class="keyword">if</span>(sObj.isDataMaskSet)
                    selectorArray=sObj.findIndFromDataMask;
                <span class="keyword">else</span>
                    selectorArray=1:sObj.dimension;
                <span class="keyword">end</span>
            <span class="keyword">end</span>
            s3   = sObj.copySignal;
            time = s3.time;
            <span class="keyword">if</span>(isa(selectorArray,<span class="string">'cell'</span>))
                data=[];
               <span class="keyword">for</span> i=1:length(selectorArray)
                   offset=0;
                   data = [data s3.data(:,selectorArray{i})];
                   <span class="keyword">for</span> j=1:length(selectorArray{i})
                        dataLabels{offset + j} = s3.dataLabels{selectorArray{i}(j)};
                        <span class="keyword">if</span>(~isempty(s3.plotProps))
                            plotProps{offset+ j} = s3.plotProps{selectorArray{i}(j)};
                        <span class="keyword">end</span>
                   <span class="keyword">end</span>
                   offset = offset + length(selectorArray{i});
               <span class="keyword">end</span>
            <span class="keyword">else</span>
                data = s3.data(:,selectorArray);
                dataLabels = cell(1,length(selectorArray));
                plotProps  = [];
                <span class="keyword">for</span> i=1:length(selectorArray)
                    dataLabels{i}= s3.dataLabels{selectorArray(i)};
                    <span class="keyword">if</span>(~isempty(s3.plotProps))
                        plotProps{i} = s3.plotProps{selectorArray(i)};
                    <span class="keyword">end</span>
                <span class="keyword">end</span>
            <span class="keyword">end</span>




            name = s3.name;
            xlabelval = s3.xlabelval; xunits=s3.xunits; yunits = s3.yunits;
            sOut=SignalObj(time, data, name, xlabelval, xunits, yunits, dataLabels, plotProps);

        <span class="keyword">end</span>
        <span class="keyword">function</span> sOut = getSubSignalFromNames(sObj,labels)
            ind   = sObj.getIndicesFromLabels(labels);
            <span class="keyword">if</span>(isa(ind,<span class="string">'cell'</span>))
                <span class="keyword">if</span>(length(ind)&gt;1)
                    <span class="keyword">for</span> i=1:length(ind)
                        s{i} = getSubSignalFromInd(ind{i});
                    <span class="keyword">end</span>
                    sOut = s{1}.merge(s{2:end});
                <span class="keyword">else</span>
                    sOut = sObj.getSubSignalFromInd(ind{1});
                <span class="keyword">end</span>
            <span class="keyword">elseif</span>(isa(ind,<span class="string">'double'</span>))
                sOut  = sObj.getSubSignalFromInd(ind);
            <span class="keyword">end</span>
        <span class="keyword">end</span>

        <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
        <span class="comment">%Plotting Functions</span>
        <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
        <span class="comment">%   plotProps: is a cell array with strings in each a entry.</span>
        <span class="comment">%              The strings must evaluate to parameters that can be</span>
        <span class="comment">%              passed to the standard matlab plot function.</span>
        <span class="comment">%   example: To plot a three dimensional signals with each line</span>
        <span class="comment">%   with specific properties (not the use of double quotes on the</span>
        <span class="comment">%   color entries so that the actual arguments have a quotes around</span>
        <span class="comment">%   them.</span>
        <span class="comment">%</span>
        <span class="comment">% &gt;&gt; plotProps = {{' ''-.g'', ''LineWidth'' ,2'},...</span>
        <span class="comment">%                 {' ''k'', ''LineWidth'' ,2'},...</span>
        <span class="comment">%                 {' ''-.b'' '}};</span>
        <span class="comment">%</span>
        <span class="comment">%   selectorArrray: is either an numeric array indexing the</span>
        <span class="comment">%                   elements within the SignalObj data or a cell array</span>
        <span class="comment">%                   of characters that refers to the data elements</span>
        <span class="comment">%                   by their labels.</span>
        <span class="comment">% % 8-25-09 : Legend wont plot is SignalObj dimension &gt;10;</span>
        <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
        <span class="keyword">function</span> h=plot(sObj,selectorArray,plotProps,handle)
            <span class="keyword">if</span>(nargin&lt;4)
                handle=gca;
            <span class="keyword">end</span>
           <span class="keyword">if</span>(nargin&lt;3)
              plotProps=sObj.plotProps;
           <span class="keyword">end</span>
           <span class="keyword">if</span>(nargin&lt;2)
                <span class="keyword">if</span>(sObj.isMaskSet)
                    selectorArray=sObj.findIndFromDataMask;
                    <span class="keyword">if</span>(isempty(selectorArray))
                        h=[];
                        <span class="keyword">return</span>;
                    <span class="keyword">end</span>
                <span class="keyword">else</span>
                    selectorArray=1:sObj.dimension;
                <span class="keyword">end</span>
           <span class="keyword">end</span>


            <span class="keyword">if</span>(isa(selectorArray,<span class="string">'cell'</span>))
                sArray = sObj.convertNamesToIndices(selectorArray);
            <span class="keyword">elseif</span>(isa(selectorArray,<span class="string">'char'</span>))
                sArray = sObj.convertNamesToIndices(selectorArray);
            <span class="keyword">elseif</span>(isa(selectorArray,<span class="string">'double'</span>))
                sArray = selectorArray;
            <span class="keyword">else</span>
                error(<span class="string">'selectorArray must contain either dataLabels or their indices'</span>);
            <span class="keyword">end</span>



           <span class="keyword">if</span>(length(plotProps)==length(sArray))
                <span class="keyword">for</span> i=1:length(sArray)
                    sObj.setPlotProps(plotProps{i},sArray(i));
                <span class="keyword">end</span>
           <span class="keyword">elseif</span>(length(plotProps)&lt;=length(sArray) &amp;&amp; length(plotProps)==1)
               <span class="keyword">for</span> i=1:length(sArray)
                    sObj.setPlotProps(plotProps,sArray(i));
               <span class="keyword">end</span>
           <span class="keyword">end</span>




            <span class="comment">%If the dimensions of the data are larger than one can specify</span>
            <span class="comment">%the plot style for each dimension by placing their values in</span>
            <span class="comment">%an cell array.</span>
            h=gcf;figure(h);
            <span class="keyword">if</span>(nargin&gt;=3)  <span class="comment">%is we got called with parameter use those</span>
                <span class="comment">%sObj.setPlotProps(plotProps); %Only accepts entire cell of plotting properties as input</span>
                <span class="comment">%if(length(plotCell)&gt;=length(sArray)) %if we specified plot parameters for each dimension</span>
                <span class="keyword">for</span> i=sArray
                    <span class="comment">%plotStr=cell2str(plotCell{:,find(sArray==i)});</span>
                    plotStr=cell2str(sObj.getPlotProps(i));
                    <span class="keyword">if</span>(~strcmp(plotStr,<span class="string">''</span>) &amp;&amp; ~isempty(plotStr))
                        evalstring = strcat(<span class="string">'h('</span>,num2str(find(sArray==i)),<span class="string">')=plot(handle,sObj.time,sObj.data(:,'</span>,num2str(i),<span class="string">'),'</span>, plotStr,<span class="string">');'</span>);
                    <span class="keyword">else</span>
                        evalstring = strcat(<span class="string">'h('</span>,num2str(find(sArray==i)),<span class="string">')=plot(handle,sObj.time,sObj.data(:,'</span>,num2str(i),<span class="string">'));'</span>);
                    <span class="keyword">end</span>
                    <span class="comment">%evalstring</span>
                    eval(evalstring); hold <span class="string">on</span>;
                <span class="keyword">end</span>
            <span class="keyword">elseif</span>(sObj.plotPropsSet) <span class="comment">%% We use the values that have been set previously</span>
                <span class="comment">%plotCell = cell2str(sObj.getPlotProps(i));</span>
                <span class="comment">%fprintf('varargin is not empty')</span>
                <span class="keyword">for</span> i=sArray
                    plotStr =cell2str(sObj.getPlotProps(i));
                    <span class="comment">%plotStr=cell2str(plotCell{:,1});</span>
                    <span class="keyword">if</span>(~strcmp(plotStr,<span class="string">''</span>) &amp;&amp; ~isempty(plotStr))
                        evalstring = strcat(<span class="string">'h('</span>,num2str(i),<span class="string">')=plot(handle,sObj.time,sObj.data(:,'</span>,num2str(i),<span class="string">'),'</span>, plotStr,<span class="string">');'</span>);
                    <span class="keyword">else</span>
                        evalstring = strcat(<span class="string">'h('</span>,num2str(i),<span class="string">')=plot(handle,sObj.time,sObj.data(:,'</span>,num2str(i),<span class="string">'));'</span>);
                    <span class="keyword">end</span>
                    <span class="comment">%evalstring</span>
                    eval(evalstring); hold <span class="string">on</span>;
                <span class="keyword">end</span>
            <span class="keyword">else</span> <span class="comment">%We didnt get any plotting properties. Use matlab default</span>
                <span class="comment">%plotCell{1} = '''';</span>
                <span class="comment">%fprintf('varargin is empty')</span>
                h=plot(handle,sObj.time,sObj.data(:,sArray));
            <span class="keyword">end</span>

            <span class="keyword">if</span>(~strcmp(sObj.xunits,<span class="string">''</span>))
                xunitsStr=strcat(<span class="string">'\; ['</span>,sObj.xunits,<span class="string">']'</span>); <span class="comment">%\; is a large space in latex</span>
            <span class="keyword">else</span>
                xunitsStr=<span class="string">''</span>;
            <span class="keyword">end</span>

            <span class="keyword">if</span>(~strcmp(sObj.yunits,<span class="string">''</span>))
                yunitsStr=strcat(<span class="string">'\; ['</span>,sObj.yunits,<span class="string">']'</span>);
            <span class="keyword">else</span>
                yunitsStr=<span class="string">''</span>;
            <span class="keyword">end</span>

            <span class="keyword">if</span>(strcmp(sObj.xlabelval,<span class="string">''</span>))
                xlabel(strcat(<span class="string">'$$'</span>,xunitsStr,<span class="string">'$$'</span>),<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>);

            <span class="keyword">else</span>
<span class="comment">%                 strcat(['$$' sObj.xlabelval xunitsStr '$$'])</span>
                xlabel(strcat(<span class="string">'$$'</span>,[sObj.xlabelval xunitsStr],<span class="string">'$$'</span>),<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>);

            <span class="keyword">end</span>
            <span class="keyword">if</span>(~strcmp(sObj.name,<span class="string">''</span>))
                <span class="keyword">if</span>(~strcmp(yunitsStr,<span class="string">''</span>))
                    <span class="comment">%strcat('$$',sObj.name,yunitsStr,'$$')</span>
                    ylabel(strcat(<span class="string">'$$'</span>,[sObj.name yunitsStr],<span class="string">'$$'</span>),<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>);

                <span class="keyword">else</span>

                    ylabel(strcat(<span class="string">'$$'</span>,sObj.name,<span class="string">'$$'</span>),<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>);
                    <span class="comment">%ylabel(sObj.name,'Interpreter','none');</span>

                <span class="keyword">end</span>
            <span class="keyword">end</span>

            <span class="keyword">if</span>(~sObj.areDataLabelsEmpty &amp;&amp; sObj.dimension&lt;10)
                labelArray= cell(1,length(sArray));
                <span class="keyword">for</span> i=1:length(sArray)
                    labelArray{i} = strcat(<span class="string">'$$'</span>,sObj.dataLabels{sArray(i)},<span class="string">'$$'</span>);

                <span class="keyword">end</span>
                legend(labelArray,<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>);
            <span class="keyword">end</span>
            axis <span class="string">tight</span>;
        <span class="keyword">end</span>

        <span class="keyword">function</span> h=plotVariability(sObj,linewidth,faceColor,ciUpper,ciLower)
            <span class="keyword">if</span>(nargin&lt;3)
                faceColor=<span class="string">'red'</span>;
            <span class="keyword">end</span>
            <span class="keyword">if</span>(nargin&lt;3)
                linewidth=3;
            <span class="keyword">end</span>
            <span class="keyword">if</span>(nargin&lt;2)
                <span class="keyword">if</span>(sObj.isMaskSet)
                    selectorArray=sObj.findIndFromDataMask;
                    <span class="keyword">if</span>(isempty(selectorArray))
                        h=[];
                        <span class="keyword">return</span>;
                    <span class="keyword">end</span>
                <span class="keyword">else</span>
                    selectorArray=1:sObj.dimension;
                <span class="keyword">end</span>
            <span class="keyword">end</span>


            <span class="keyword">if</span>(isa(selectorArray,<span class="string">'cell'</span>))
                sArray = sObj.convertNamesToIndices(selectorArray);
            <span class="keyword">elseif</span>(isa(selectorArray,<span class="string">'char'</span>))
                sArray = sObj.convertNamesToIndices(selectorArray);
            <span class="keyword">elseif</span>(isa(selectorArray,<span class="string">'double'</span>))
                sArray = selectorArray;
            <span class="keyword">else</span>
                error(<span class="string">'selectorArray must contain either dataLabels or their indices'</span>);
            <span class="keyword">end</span>

            <span class="comment">%Take the unique dataLabels and compute the variability of</span>
            <span class="comment">%these signals</span>

            UniqueSigLabels = unique(sObj.getSubSignal(sArray).dataLabels);


            <span class="keyword">for</span> i=1:length(UniqueSigLabels)
                meanSig = mean(sObj.getSubSignal(UniqueSigLabels{i}),2);

                <span class="keyword">if</span>(nargin&lt;4)
                    ci2=meanSig.data+std(meanSig.dataToMatrix);
                <span class="keyword">else</span>
                    ci2=meanSig.data+ciUpper;
                <span class="keyword">end</span>

                <span class="keyword">if</span>(nargin&lt;5)
                    ci1=meanSig.data-std(meanSig.dataToMatrix);
                <span class="keyword">else</span>
                    ci1=meanSig.data+ciLower;
                <span class="keyword">end</span>


                plot(sObj.time,meanSig.dataToMatrix,<span class="string">'k-'</span>,<span class="string">'linewidth'</span>,linewidth);
                hold <span class="string">on</span>;
                p=patch([reshape(sObj.time,[1 length(sObj.time)]) reshape(fliplr(sObj.time'),[1 length(sObj.time)])],<span class="keyword">...</span>
                        [reshape(ci1',[1 length(sObj.time)])       reshape(fliplr(ci2'),[1,length(sObj.time)])],strcat(<span class="string">''</span>,faceColor{1},<span class="string">''</span>));
                set(p,<span class="string">'facecolor'</span>,faceColor,<span class="string">'edgecolor'</span>,<span class="string">'none'</span>);
                alpha(.5);
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span> <span class="comment">% public methods</span>




<span class="keyword">end</span><span class="comment">%classdef</span>

<span class="comment">% Helper function</span>
<span class="keyword">function</span> stringout=cell2str(input)
    <span class="keyword">if</span>(isempty(input))
        stringout = <span class="string">''</span>;
    <span class="keyword">else</span>
        <span class="keyword">if</span>(isa(input,<span class="string">'char'</span>))
            stringout=input;
        <span class="keyword">elseif</span>(isa(input,<span class="string">'cell'</span>))
            stringout=cell2str(input{1});
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>
</pre><pre class="codeoutput">Input argument "time" is undefined.

Error in ==&gt; SignalObj&gt;SignalObj.SignalObj at 96
            [l,w]=size(time);
</pre><p class="footer"><br>
            Published with MATLAB&reg; 7.8<br></p>
      </div>
      <!--
##### SOURCE BEGIN #####
classdef SignalObj < handle
    %SignalObj Class representing a signal abstraction
    %   SignalObj consist of data that is indexed by time (as a default). The
    %   indexing variable can be any other type of data and the x-axis labels 
    %   modified to represent this change. 
    %
    %   A SignalObj can be multivariate in that the data can have more than one component. The
    %   sample rate of the SignalObj is determined by the time increment used
    %   in the time sequence used when the SingalObj is created
    %
    %   Usage:  
    %   >> s=SignalObj(time, data, name, xlabelval, xunits, yunits, dataLabels, plotProps)
    %
    %   Only time and data need to be specified. Other arguments are optional.
    %   
    %
    %  time: indexing variable for the data. n x 1 or 1 x n array. The sample 
    %        rate is determined by the time increment between samples of this vector. Units of 
    %        [sec] are assumed, but need not be used. If the time vector is 
    %        in units of [sec], the sampleRate is in units of [Hz]. If the 
    %        time vector is in units of [msec] then the sampleRate is in 
    %        units of [1/msec] or 10^3 [Hz].
    %
    %  data: n x m or m x n array reprenting the signal at each index of the time vector.
    %        The dimension that is compatible with the time vector will be automatically detected. 
    %        Thus a SignalObj can be created by either passing the data matrix or its transpose. The remaining
    %        dimension will determine the dimensionality of the SignalObj.
    %
    %  name: string that determines the name of the signal. This is used to
    %        label the y-axis of the SignalObj.
    %
    %  xlabelval: A string specifying the name of the indexing variable. If
    %        this value is not specified, 'time' is used.
    %
    %  xunits: A string specifying the name of the units of the indexing
    %          variable. In not specified, 'sec' is used.
    %         
    %  yunits: A string specifying the units of the SignalObj. Used when plotting the SignalObj.       
    %
    %  dataLabels: If data is multivariate, the names of the components of the SignalObj can be specified. 
    %              These can be used to reference specific data within the
    %              signal (e.g. the x-component of a 3-d vector) and are
    %              also used for plotting. SignalObj's will be created for
    %              each component of the orignal SignalObj under the
    %              vars field. Can be specified all at once or by a cell of
    %              strings.
    %
    %  plotProps:  Can be specified for each component of the SignalObj
    %              individually or by a cell of string of same dimension as the 
    %              number of components in the data. 
    %
    % 
    %
    % <a href="matlab:web(fullfile(strread(userpath,'%s','delimiter',';'),'Code Development','Signal','trunk','html','SignalObjExamples.html'))">SignalObj Examples</a>

    
    properties (SetAccess = private)
        name       % name of the SignalObj
        time       % time vector
        data       % actual SignalObj data
        dimension  % number of different components of the SignalObj
        minTime    % minimum Time value of the SignalObj
        maxTime    % maximum Time value of the SignalObj
        xlabelval  % label to use for the x-axis
        xunits     % units for x-axis
        yunits     % units for y-axis data
        dataLabels % labels for each dimension of the data;
        dataMask   % vector same length as SignalObj dimension. a 1 indicates this SignalObj should be output a 0 otherwie
        sampleRate % Hz if time is in seconds
        plotProps  % Plotting properties        
    end
    properties (Hidden)
        origSampleRate
        originalTime %original timeVector
        originalData %original Data
    end
    properties (Dependent = true)    
        vars %Contains subfields of the same names as the dataLabels that contain Signals with only the data corresponding to that label.
    end
    methods
        %Constructor
        function s=SignalObj(time, data, name, xlabelval, xunits, yunits, dataLabels, plotProps)

            if(nargin<6)
                yunits='';
            end
            if(nargin<5)
                xunits='s';
            end
            if(nargin<4)
                xlabelval='time';
            end
            if(nargin<3)
                name='';
            end
            [l,w]=size(time);
            if(l>=w);
                if(w>1)
                    error('Time vector can only have one dimension');
                else
                    s.time=time;
                    
                end
            elseif(l<=w)
                if(l>1)
                    error('Time vector can only have one dimension');
                else
                    s.time=time';
                end
            end
            s.originalTime=s.time;
            [l,w]=size(data);
           if(l==length(s.time));
                s.data=data;
                s.dimension =w;
            elseif(w==length(s.time));
                s.data=data';
                s.dimension=l;
           else
               error('Data dimensions do not match the time vector specified');
           end
           s.originalData = s.data;
            if(nargin <7)
                for i=1:s.dimension
                    dataLabels{i} = '';
                end
            end
            s.dataMask  = ones(1,s.dimension);   
            if(nargin<8)
                plotProps = cell(s.dimension,1);
            end
            s.sampleRate = 1/mean(diff(s.time));
            s.origSampleRate = s.sampleRate;
            s.name=name;
            s.xlabelval=xlabelval;
            s.xunits=xunits;
            s.yunits=yunits;
            s.minTime=min(s.time);
            s.maxTime=max(s.time);
            s.setPlotProps(plotProps);
            s.setDataLabels(dataLabels);
        end
        
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %Set functions    
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        function setName(sObj,name) %set the name after construction
            if(isa(name,'char'))
                sObj.name = name;
            else
                error('Name must be a string!');
            end
        end     
        function setXlabel(sObj,name)
            sObj.xlabelval = name;
        end
        function setYLabel(sObj,name)
            sObj.setName(name);            
        end
        function setUnits(sObj, xUnits, yUnits)
            if(nargin==3)
                if(isa(yUnits,'char'))
                    sObj.setYunits(yUnits);
                end
            end
            if(nargin>=2)
                if(isa(xUnits,'char'))
                    sObj.setXunits(xUnits);
                end
            end
        end
        function setXUnits(sObj, units)
            if(isa(units, 'char'))
                sObj.xunits = units;
            end
        end
        function setYUnits(sObj, units)
            if(isa(units,'char'))
                sObj.yunits = units;
            end
        end
        function setSampleRate(sObj, sampleRate)
%             sampleRate
%             sObj.sampleRate
%             ~(sampleRate==sObj.sampleRate)
            if(~(floor(sampleRate*100)/100==floor(sObj.sampleRate*100)/100)) %Compare to 2 decimal places (finite precision has caused errors 500.000001 ~= 500.00000x
                if(sampleRate>sObj.sampleRate)
                    %fprintf(strcat('SignalObj,',sObj.name',', upsampled to:',num2str(sampleRate)));
                else
                    %fprintf(strcat('SignalObj,',sObj.name',', downsampled to:',num2str(sampleRate)));
                end
                sObj.resampleMe(sampleRate);
            end
        end
        function setDataLabels(sObj,dataLabels)
            if(isa(dataLabels,'char'))
                if(sObj.dimension==1)
                    sObj.dataLabels{1}=dataLabels;
                else
                    error('Adding single dataLabel to a SignalObj with more that 1 dimension');
                end
                
            elseif(isa(dataLabels,'cell'))
                if(length(dataLabels)==sObj.dimension)
                    ind=sObj.findIndFromDataMask;
                    for i=ind
                        sObj.dataLabels{i} = dataLabels{i};
                    end                                     
                else
                    error('Need the number of labels to match the number of dimensions of the SignalObj');
                end
            end
        end
        function setMinTime(sObj,minTime,holdVals)
            if(nargin<3)
                holdVals=0;
            end
            
            if(nargin<2)
                minTime=sObj.time(1);
            end
            timeVec=sObj.getTime;
            if(minTime<min(timeVec))
                maxTime=max(timeVec);
                newTime=minTime:1/sObj.sampleRate:maxTime;
                numSamples = length(newTime)-length(timeVec);
                if(holdVals==1)
                    newData=[ones(numSamples,1)*sObj.data(1,:);sObj.data];
                else
                    newData=[zeros(numSamples,sObj.dimension);sObj.data];
                end
                sObj.data=newData;
                sObj.time=newTime;
                sObj.minTime=min(sObj.time);
            elseif(min(timeVec)==minTime)
                    %do nothing
            else
                startIndex = sObj.findNearestTimeIndex(minTime);
                sObj.time=sObj.time(startIndex:end);
                sObj.data=sObj.data(startIndex:end,:);
            end
            sObj.minTime=min(sObj.time);
        end
        function setMaxTime(sObj,maxTime, holdVals)
            if(nargin<3)
                holdVals=0;
            end
            
            if(nargin<2)
                maxTime=sObj.time(end);
            end
            timeVec=sObj.getTime;
            if(max(timeVec)<maxTime)
                minTime=min(timeVec);
                newTime=minTime:1/sObj.sampleRate:maxTime;
                numSamples = length(newTime)-length(timeVec);
                if(holdVals==1)
                    newData=[sObj.data;ones(numSamples,1)*sObj.data(end,:)];
                else
                    newData=[sObj.data;zeros(numSamples,sObj.dimension)];
                end
                
                sObj.data=newData;
                sObj.time=newTime;
                sPnj.maxTime=max(sObj.time);
            elseif(max(timeVec)==maxTime)
                    %do nothing
                
            else
                endIndex = sObj.findNearestTimeIndex(maxTime);
                sObj.time=sObj.time(1:endIndex);
                sObj.data=sObj.data(1:endIndex,:);
            end
            sObj.maxTime=max(sObj.time);
        end
        function setPlotProps(sObj, plotProps,index)
            if(nargin<=2)
                if(isa(plotProps,'cell'))
                    if(length(plotProps) == sObj.dimension)
                        for i=1:sObj.dimension
                            sObj.plotProps{i} = cell2str(plotProps{i});
                        end
                    elseif(length(plotProps)==1)
                        for i=1:sObj.dimension
                            sObj.plotProps{i} = cell2str(plotProps);
                            display('Index not specified. All dimensions set to have same plotting properties');
                        end
                    else
                        error('Index not specified and more than 1 plotProp specified. Need to number of plotProps same as sObj.dimension or length 1');
                    end
                elseif(isa(plotProps,'char'))
                     for i=1:sObj.dimension
                        sObj.plotProps{i} = cell2str(plotProps);
                     end
                     display('All dimensions set to have same plotting properties')
                end
               
            else
                if(isa(plotProps,'cell') && length(plotProps)==1)
                    if(index>0 && index<=sObj.dimension)
                        sObj.plotProps{index} = plotProps{:};
                    else
                        error('Index out of bounds during setPlotProps');
                    end
                elseif(isa(plotProps,'char'))
                     if(index>0 && index<=sObj.dimension)
                        sObj.plotProps{index} = plotProps;
                    else
                        error('Index out of bounds during setPlotProps');
                    end
                    
                end
            end
        end  
        function setMask(sObj, mask)
            if(nargin<2)
                mask=zeros(1,sObj.dimension);
                sObj.setDataMask(mask);
                return;
            end
            %mask is either a set of indices or names;
            if(isa(mask,'cell'))
                if(isa(mask{1},'char'))
                    sObj.setMaskByLabels(mask);
                else
                    error('Mask cells must contains strings!');
                end
            elseif(isa(mask,'double'))
                sObj.setMaskByInd(mask);
            else
                error('Can only set datamask with strings or indices')
            end
        end
        function setDataMask(sObj, dataMask)
        %DataMasks affect how the SignalObj is visualized and converted to
        %other representations. It doesnt change the dimensions of the
        %object, nor does it delete data. 
            if(length(dataMask)==sObj.dimension)
                  sObj.dataMask = dataMask;
            end
                
        end
        function setMaskByInd(sObj,index)
            if(length(index)==sObj.dimension)
                sObj.setDataMask(index);
            else
                mask=zeros(1,sObj.dimension);
                mask(index)=1;
                sObj.setDataMask(mask);
            end
        end
        function setMaskByLabels(sObj,labels)
            ind=sObj.getIndicesFromLabels(labels);
            mask=zeros(1,sObj.dimension);
            mask(ind)=1;
            sObj.setDataMask(mask);
        end      

        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%        
        function tVec       = getTime(sObj)
            tVec=sObj.time;
        end
        function data       = getData(sObj)
            data=sObj.dataToMatrix;
        end
        function [t,d]      = getOriginalData(sObj)
            t=sObj.originalTime;
            d=sObj.originalData;
        end
        function s          = getOrigDataSig(sObj)
                [time,data]=sObj.getOriginalData;
                name=sObj.name;
                xlabelval=sObj.xlabelval; 
                xunits=sObj.xunits;
                yunits=sObj.yunits; 
                dataLabels=sObj.dataLabels;
                plotProps=sObj.plotProps;
                s = SignalObj(time, data,name, xlabelval, xunits, yunits,dataLabels,plotProps);
        end
        function index      = getIndexFromLabel(sObj,label)
            index=[];
            for i=1:length(sObj.dataLabels)
                if(strcmp(label, sObj.dataLabels{i}))
                    index = [index i];
                end
            end
        end 
        function indices    = getIndicesFromLabels(sObj,label)
            %Returns a cell array if the label appears for various point
            %int the SignalObj
            %Returns an array if the SignalObj label appears only once in the
            %SignalObj
            if(isa(label,'cell'))
                indices =cell(1,length(label));
                numInd  =zeros(1,length(label));
                for i=1:length(label)
                    tempInd = sObj.getIndexFromLabel(label{i});
                    if(~isempty(tempInd))
                        numInd(i) = length(tempInd);
                        indices{i}=tempInd;
                    else
                        error('Label does not exist!');
                    end
                     
                end
            elseif(isa(label,'char'))
                indices = getIndexFromLabel(label);
                numInd = length(indices);
            end
            if(max(numInd)==1)      %For backwards compatibility if assuming only on index per label
                for i=1:length(label)
                    tempInd(i) = indices{i};
                end
                indices = tempInd;
            end
        end  
        function val        = getValueAt(sObj,x)
            ind=sObj.findNearestTimeIndex(x);
            val=sObj.data(ind,:);
        end
        function PropsStr   = getPlotProps(sObj,index)
            if(index>0 && index<=sObj.dimension)
                PropsStr = cell2str(sObj.plotProps{index});
            else
                error('index is out of bounds!');
            end
        end
        
 
        
                
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        % Operand Definitions and other mathematical operations
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        function s3 = plus(s1,s2)
            if(isa(s1,'SignalObj') && isa(s2,'SignalObj'))
                % What is s2 is a constant or double?
                if(s1.dimension == s2.dimension)
                    [s1c,s2c] = makeCompatible(s1,s2);
                    s3=s1c.copySignal;
                    s3.data = s1c.data+s2c.data;
                    
                    for i=1:length(s3.dataLabels)
                        if(strcmp(s2c.dataLabels{i}(1),'-'))
                            s3.dataLabels{i} = [s1c.dataLabels{i} '-' s2c.dataLabels{i}(2:end)];
                        else
                            s3.dataLabels{i} = [s1c.dataLabels{i} '+' s2c.dataLabels{i}];
                        end
                    end
                else
                    error('Can only add signals if they have the same dimension');
                end
            elseif(isa(s1,'double') || isa(s2,'double'))
                if(isa(s1,'double'))
                  s3=s2.copySignal;
                  [l,w] = size(s1);
                  if(w==s3.dimension && l==1)
                      s3.data = s3.data+ones(length(s3.data),1)*s1;
                      for i=1:length(s3.dataLabels)
                            if(sign(s1(i))==-1)
                                s3.dataLabels{i} = [s2.dataLabels{i} '-' num2str(abs(s1(i)))];
                            else
                                s3.dataLabels{i} = [s2.dataLabels{i} '+' num2str(abs(s1(i)))];
                            end
                      end
                  else
                      s3.data = s3.data+s1; 
                      %dont modify dataLabels since s1 is a matrix;
                             
                      %for i=1:length(s3.dataLabels)
                      %      s3.dataLabels{i} = [s2.dataLabels{i} '+' num2str(s1(i))];
                      %end
                  end
                else
                  s3=s1.copySignal;
                  [l,w] = size(s2);
                  %size(s3.data)
                  if(w==s3.dimension && l==1)
                      s3.data = s3.data+ones(length(s3.data),1)*s2;
                      for i=1:length(s3.dataLabels)
                            if(sign(s2(i))==-1)
                                s3.dataLabels{i} = [s1.dataLabels{i} '-' num2str(abs(s2(i)))];
                            else
                                s3.dataLabels{i} = [s1.dataLabels{i} '+' num2str(abs(s2(i)))];
                            end
                      end
                  else
                      
                      s3.data = s3.data+s2; 
                      %dont modify dataLabels since s2 is a matrix;
                      %for i=1:length(s3.dataLabels)
                      %      s3.dataLabels{i} = [s1.dataLabels{i} '+' num2str(s2)];
                      %end
                  end
                end
            else
                error('only Signals or doubles are currently supported');
            end
        end        
        function s3 = minus(s1,s2)
            s3=plus(s1,-s2);
        end        
        function s3 = uplus(s1) %+s1
            s3=s1.copySignal;
        end        
        function s3 = uminus(s1) %-s1
            
            s3=s1.copySignal;
            s3.data=-s3.data;
            for i=1:length(s3.dataLabels)
                s3.dataLabels{i} = strcat('-',s1.dataLabels{i});
            end
        end        
        function s3 = times(s1,s2) %s1.*s2
            if(isa(s1,'SignalObj') && isa(s2,'SignalObj'))
               if(s1.dimension == s2.dimension)
                   [s1c,s2c] = makeCompatible(s1,s2);
                   s3 = s1c;
                   s3.data = s1c.data.*s2c.data;
                   %can multiply units 
               else
                   error('can only multiply signals with same dimension');
               end
            elseif(isa(s1,'double') || isa(s2,'double'))
                if(isa(s1,'double'))
                  s3=s2.copySignal;
                  [l,w] = size(s1);
                  if(w==s3.dimension && l==1)
                      s3.data = s3.data.*(ones(length(s3.data),1)*s1);
                  else
                      s3.data = s3.data.*s1;
                  end
                else
                  s3=s1.copySignal;
                  [l,w] = size(s2);
                  if(w==s3.dimension && l==1)
                      s3.data = s3.data.*(ones(length(s3.data),1)*s2);
                  else
                      s3.data = s3.data.*s2;
                  end
                end 
            end    
        end        
        function s3 = mtimes(s1,s2) %s1*s2
            if(isa(s1,'SignalObj') && isa(s2,'SignalObj'))
                   %[s1c,s2c] = makeCompatible(s1,s2);
                   s3 = s1.copySignal;
                   s3.data = s1.data.*s2.data;
                   %can multiply units 
           elseif(isa(s1,'double') || isa(s2,'double'))
                if(isa(s1,'double'))
                  s3=s2.copySignal;
                  s3.data = (s1*s3.data')';
                else
                  s3=s1.copySignal;
                  s3.data = (s3.data'*s2)';
                end 
            end
        end        
        function s3 = rdivide(s1,s2)
            if(isa(s1,'SignalObj') && isa(s2,'SignalObj'))
               if(s1.dimension == s2.dimension)
                   [s1c,s2c] = makeCompatible(s1,s2);
                   s3 = s1c;
                   s3.data = s1c.data./s2c.data;
                   %can multiply units 
               else
                   error('can only multiply signals with same dimension');
               end
            elseif(isa(s1,'double') || isa(s2,'double'))
                if(isa(s1,'double'))
                  s3=s2.copySignal;
                  s3.data = s1./s3.data;
                else
                  s3=s1.copySignal;
                  s3.data = s3.data./s2;
                end 
            end
        end        
        function s3 = ldivide(s1,s2)
            if(isa(s1,'SignalObj') && isa(s2,'SignalObj'))
               if(s1.dimension == s2.dimension)
                   [s1c,s2c] = makeCompatible(s1,s2);
                   s3 = s1c;
                   s3.data = s1c.data.\s2c.data;
                   %can multiply units 
               else
                   error('can only multiply signals with same dimension');
               end
            elseif(isa(s1,'double') || isa(s2,'double'))
                if(isa(s1,'double'))
                  s3=s2.copySignal;
                  s3.data = s1.\s3.data;
                else
                  s3=s1.copySignal;
                  s3.data = s3.data.\s2;
                end 
            end
        end          
        function s3 = ctranspose(s1)
            s3=s1.copySignal;
            s3.data=s3.data.';
            [l,w]=size(s3.data);
            s3.dimension=w;
        end        
        function s3 = transpose(s1)
            s3=s1.copySignal;
            s3.data=s3.data.';
            [l,w]=size(s3.data);
            s3.dimension=w;
        end
        function s3 = derivative(sObj)
%             B=[1 -1]*sObj.sampleRate;
%             A=1;
%             s3=sObj.filter(B,A);
            s3=sObj.copySignal;
            tData=diff(s3.data)*s3.sampleRate;
            tData=[zeros(1,s3.dimension); tData];
            s3.data=tData;
            
            s3.setYUnits(strcat('\frac{',s3.yunits,'}{',s3.xunits,'}'));
            denomstr = strcat('d', s3.xlabelval(1));
            
            s3.setName(strcat('\frac{d}{',denomstr,'}',s3.name));
            for i=1:s3.dimension
                if(~strcmp(sObj.dataLabels{i},''))
                    s3.dataLabels{i}= strcat('\frac{d}{',denomstr,'}',s3.dataLabels{i});
                end
            end
        end        
        function val = derivativeAt(sObj,x0)
            sTemp = sObj.derivative;
            val = sTemp.getValueAt(x0);
        end        
        function s3 = integral(sObj,t0,tf)
            if(nargin<3)
                tf=sObj.maxTime;
            end
            if(nargin<2)
                t0=sObj.minTime;
            end
            
            %y[n] = y[n-1] + x[n]*deltaT
            B=1*1/sObj.sampleRate;
            A=[1 -1];
            s3=sObj.getSigInTimeWindow(t0,tf);
            s3=s3.filter(B,A);
            s3.setYUnits(strcat(s3.yunits,'*',s3.xunits));
            dtstr = strcat(' d','\tau');
            s3.setName(['\int_',num2str(s3.minTime),'^',s3.xlabelval(1),'\!\!{',[s3.name dtstr],'}']);
            for i=1:s3.dimension
                if(~strcmp(sObj.dataLabels{i},''))
                    s3.dataLabels{i}= ['\int_',num2str(s3.minTime),'^',s3.xlabelval(1),'\!\!{',[s3.dataLabels{i} dtstr],'}'];
                end
            end
        end          
        function s3 = filter(sObj, B,A)
            s3=sObj.copySignal;
            s3.data = filter(B,A,s3.data);
        end        
        function s3 = filtfilt(sObj,B,A)
            s3=sObj.copySignal;
            s3.data = filtfilt(B,A,s3.data);
        end
        function [s1c,s2c] = makeCompatible(s1,s2,holdVals)
            if(nargin<3)
                holdVals=0;
            end
            s1c = s1.copySignal; s2c = s2.copySignal;
            minTime=min(s1c.minTime,s2c.minTime);
            maxTime=max(s1c.maxTime,s2c.maxTime);
            sampleRate=max(s1c.sampleRate,s2c.sampleRate);
            s1c.setSampleRate(sampleRate); s2c.setSampleRate(sampleRate);
            s1c.setMinTime(minTime,holdVals);       s2c.setMinTime(minTime,holdVals);
            s1c.setMaxTime(maxTime,holdVals);       s2c.setMaxTime(maxTime,holdVals);
            
            %pause
%             for i=1:s2c.dimension
             data = spline(s2c.time,s2c.data',s1c.time);
%             end
             s2c.time = s1c.time;
             [nrows,ncolumns] = size(data);
             if(nrows>ncolumns)
                s2c.data = data;
             else
                s2c.data = data';
             end
        end
        function m=mean(sObj,varargin)
            mdata=mean(sObj.data,varargin{:});
            [nrows,ncolumns]=size(mdata);
            if( (nrows==length(sObj.time)) && (ncolumns==1) ) %mean across dimensions
                m=SignalObj(sObj.time, mdata, ['Mean of ' sObj.name],sObj.xlabelval, sObj.xunits,sObj.yunits); 
            elseif( (nrows==1) && (ncolumns == sObj.dimension) )  %mean of each dimension
                if(~sObj.areDataLabelsEmpty)
                    dataLabels = cell(size(sObj.dataLabels));
                    for i=1:sObj.dimension
                        dataLabels{i} = strcat('\mu(',sObj.dataLabels{i},')');
                    end
                     m=SignalObj([sObj.time(1); sObj.time(end)], [mdata;mdata], ['Mean of ' sObj.name],sObj.xlabelval, sObj.xunits,sObj.yunits,dataLabels);
                else
                    m=SignalObj([sObj.time(1); sObj.time(end)], [mdata;mdata],  ['Mean of ' sObj.name],sObj.xlabelval, sObj.xunits,sObj.yunits);
                end
            end
        end
        function m=max(sObj,varargin)
            m=max(sObj.data,varargin{:});
        end
        function m=min(sObj,varargin)
            m=min(sObj.data,varargin{:});
        end
        function periodogram = periodogram(sObj)
            fs = sObj.sampleRate;  % Sampling frequency
            periodogram = cell(1,sObj.dimension);
            for i=1:sObj.dimension
                xn = sObj.data(:,i);
                Hs = spectrum.periodogram('rectangular');
                switch sObj.dimension
                    case 2
                        subplot(1,2,i)
                    case 3
                        subplot(1,3,i)
                    case 4
                        subplot(2,2,i)
                    case 5
                        subplot(3,2,i)
                    case 6
                        subplot(3,2,i)
                    otherwise
                         h=gcf;figure(h);
                end
                periodogram{i}=psd(Hs,xn,'Fs',fs,'NFFT',1024);
                h=periodogram{i}.plot;legend(h, sObj.dataLabels{i});
            end
        end
        function mtmSpec = MTMspectrum(sObj,NW,NFFT,Pval)
            if(nargin<4)
                Pval=.95;
            end
            if(nargin<3)
                NFFT=[];
            end
            if(nargin<2)
                NW=4;
            end
            
            Fs=sObj.sampleRate;
            mtmSpec = cell(1,sObj.dimension);
            for i=1:sObj.dimension
                xn=sObj.data(:,i);
                [Pxx,Pxxc,f] = pmtm(xn,NW,NFFT,Fs,Pval);
                hpsd = dspdata.psd([Pxx Pxxc],'Fs',Fs);
                mtmSpec{i} = hpsd;
                switch sObj.dimension
                    case 2
                        subplot(1,2,i)
                    case 3
                        subplot(1,3,i)
                    case 4
                        subplot(2,2,i)
                    case 5
                        subplot(3,2,i)
                    case 6
                        subplot(3,2,i)
                    otherwise
                         h=gcf;figure(h);
                end
                str1=strcat(num2str(Pval*100), '% Conf. Int.');
                h=plot(hpsd); legend(h, sObj.dataLabels{i},strcat('-',str1),strcat('+',str1));
            end
        end
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %Utility Functions
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        function mergedSig = merge(sObj,varargin)
            numToMerge=0;
            holdVals=0;
            for i=1:length(varargin)
                if(isa(varargin{i},'SignalObj'))
                    numToMerge = numToMerge+1;
                end
                if(isa(varargin{i},'double')&&i==length(varargin)) %expect only one double at the end
                    holdVals = varargin{i};
                end
            end

            if(numToMerge == 1)
                [s1c, s2c] = sObj.makeCompatible(varargin{1},holdVals);
                 data=[s1c.dataToMatrix, s2c.dataToMatrix];
                 dataLabels = cell(s1c.dimension+s2c.dimension,1);
                 for i=1:s1c.dimension
                        dataLabels{i} = s1c.dataLabels{i}; 
                 end
                 for i=1:s2c.dimension
                        dataLabels{s1c.dimension+i}=s2c.dataLabels{i};
                 end
                 name = [s1c.name, ',', s2c.name];
                 mergedSig = SignalObj(s1c.time, data, name, s1c.xlabelval,s1c.xunits, s1c.yunits, dataLabels);
            else
                  mergedSig = sObj.merge(varargin{1},holdVals);
                  for i=2:numToMerge
                        mergedSig = mergedSig.merge(varargin{i},holdVals);
                  end
            end
        end        
        function sigOut=copySignal(sigIn)
                time=sigIn.time; 
                data=sigIn.data;
                name=sigIn.name;
                xlabelval=sigIn.xlabelval; 
                xunits=sigIn.xunits;
                yunits=sigIn.yunits; 
                dataLabels=sigIn.dataLabels;
                plotProps=sigIn.plotProps;
                sigOut = SignalObj(time, data,name, xlabelval, xunits, yunits,dataLabels,plotProps);
                sigOut.dataMask = sigIn.dataMask;
        end
        function sObjOut=resample(sObj, newSampleRate)
            sObjOut = sObj.copySignal;
            sObjOut.resampleMe(newSampleRate);
        end
        function resampleMe(sObj, newSampleRate)
            sObj.restoreToOriginal; %use default data for changing samplerate
            %Change the sampling rate of this object
            minTime=sObj.minTime;
            maxTime=sObj.maxTime;
            newTime=minTime:1/newSampleRate:maxTime;
            newData=zeros(length(newTime),sObj.dimension);
            for i=1:sObj.dimension
                newData(:,i)= spline(sObj.time,sObj.data(:,i),newTime);
            end
                sObj.time=newTime;
                sObj.data=newData;
                sObj.sampleRate=newSampleRate;
        end
        function restoreToOriginal(sObj,rMask)
            if(nargin<2)
              rMask = 0; %keep mask even when data reset
            end
             [time,data]=sObj.getOriginalData;
             sObj.time=time;
             sObj.data=data;
             sObj.minTime=min(time);
             sObj.maxTime=max(time);
             sObj.sampleRate = 1/mean(diff(time));
             if(rMask==1)
                 sObj.resetMask;
             end
        end
        function resetMask(sObj)
            sObj.dataMask = ones(1,sObj.dimension);       
        end
        function ind = findIndFromDataMask(sObj)
            ind = find(sObj.dataMask ==1);
%             if(isempty(ind))
%                 error('All data masked out of SignalObj');
%             end
        end        
        function ind=findNearestTimeIndex(sObj, time)
            if(time<sObj.minTime)
                ind=1;
            elseif(time>sObj.maxTime)
                ind=length(sObj.time);
            else
                ind1=find(sObj.time>=time,1,'first');
                ind2=find(sObj.time<=time,1,'last');
                if(abs(sObj.time(ind1)-time)<=abs(sObj.time(ind2)-time))
                    ind=ind1;
                else
                    ind=ind2;
                end
%                 if(time-sObj.minTime < sObj.maxTime-time) %Time is close to beginning
%                     ind=min([ind1, ind2]);
%                 else
%                     ind=max([ind1, ind2]);
%                 end
            end
        end
        function sOut = shift(sObj, deltaT)
           
            %returns s shift by deltaT. If deltaT is positive
            %the SignalObj is moved deltaT time steps forward
            %if deltaT is negative, the SignalObj is moved deltaT units
            %backwards.
            %compute number of samples delayed
            sOut=sObj.copySignal;
            newMinTime = sOut.minTime+deltaT;
            newMaxTime = sOut.maxTime+deltaT;
            newTime=newMinTime:1/sOut.sampleRate:newMaxTime;
            sOut.time = newTime;
            sOut.minTime = newMinTime;
            sOut.maxTime = newMaxTime;
        end
        function shiftMe(sObj,deltaT)
            sTemp = sObj.shift(deltaT);
            sObj.data=sTemp.data;
            sObj.time=sTemp.time;
        end        
        function alignTime(sObj, timeMarker,newTime)
            if(sObj.minTime<=timeMarker && sObj.maxTime>=timeMarker)
                deltaT=newTime-timeMarker;
                sObj.shiftMe(deltaT);            
            end
        end     
        function answer = plotPropsSet(sObj)
            answer =0;
            for i=1:sObj.dimension
                if(~strcmp(sObj.getPlotProps(i),''))
                    answer=1;
                    break;
                end
            end
        end
        function answer = areDataLabelsEmpty(sObj)
            answer = 1;
            for i=1:length(sObj.dataLabels);
                if(~strcmp(sObj.dataLabels{i},''))
                    answer = 0;
                    break;
                end
            end
        end
        function answer = isLabelPresent(sObj, label)
            if(isa(label,'char'))
                if(strcmp(label,'all')||~isempty(sObj.getIndexFromLabel(label)))
                    answer=1;
                else
                    answer=0;
                end
            else
                error('Labels must be a char');
            end
        end
        function answer = isMaskSet(sObj)
            answer=~isempty(sObj.dataMask==0);
        end
        function sArray = convertNamesToIndices(sObj, selectorArray)
            if(sObj.areDataLabelsEmpty)
                sArray = 1:sObj.dimension; % Return all the data;
                fprintf('tried to find data by labels but data doesnot have labels assigned');
            else
                if(isa(selectorArray, 'char'))
                    if(strcmp(selectorArray,'all'))
                        sArray=1:sObj.dimension;
                    elseif(sObj.isLabelPresent(selectorArray))
                        sArray=sObj.getIndexFromLabel(selectorArray);
                    else
                        error('Specified label does not match data label');
                    end
                        
                elseif(isa(selectorArray, 'double'))
                    sArray=selectorArray;
                elseif(isa(selectorArray, 'cell'))
                    sArray = zeros(1, length(selectorArray));
                    for i=1:length(sArray)
                        if(sObj.isLabelPresent(selectorArray{i}))
                            sArray(i) = sObj.getIndexFromLabel(selectorArray{i});
                        end
                    end
                else
                    error('selectorArray cells must contain text');
                end 
            end
        end
        function [indices, values] = findPeaks(sObj,type)
            if(nargin<2)
                type='maxima';
            end
            values=cell(1,sObj.dimension);
            indices=cell(1,sObj.dimension);
            if(strcmp(type,'maxima'))
                for i=1:w
                    [values{i},indices{i}] = findPeaks(sObj.data(:,i));
                end
            elseif(strcmp(type,'minima'))
                for i=1:w
                    [values{i},indices{i}] = findPeaks(sObj.data(:,i));
                end
            end
        end
        function [indices, values] = findMaxima(sObj)
            [indices,values]=sObj.findPeaks('maxima');
        end
        function [indices, values] = findMinima(sObj)
            [indices,times,values]= sObj.findPeaks('minima');
        end        
        function clearPlotProps(sObj,index)
            if(nargin<2)
                index=1:sObj.dimension;
            end
            tempCell = cell(length(index),1);
            for i=index
                sObj.plotProps{i} = cell2str(tempCell{i});
            end
            
        end
        function v=get.vars(sObj)
            if(~sObj.areDataLabelsEmpty)
                UniqueSigLabels = unique(sObj.dataLabels);
                
                for i=1:length(UniqueSigLabels)
                    eval(strcat('v.(''',UniqueSigLabels{i},''')=sObj.getSubSignal(''',UniqueSigLabels{i},''');'));
                end
            %sObj.vars=v;
            else
                for i=1:sObj.dimension
                    
                    eval(strcat('v.(''',sObj.dataLabels{i},''')=sObj.getSubSignal(i);'))
                end
            end
        end
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %Change of Representation Functions
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        function structure=dataToStructure(sObj,selectorArray)
            if(nargin<2)
                if(sObj.isMaskSet)
                    selectorArray=sObj.findIndFromDataMask;
                else
                    selectorArray=1:sObj.dimension;
                end
            end
            %Convert to a standard matlab structure
            structure.time=sObj.time;
            structure.signals.values=sObj.dataToMatrix(selectorArray);
        end
        function dataMat=dataToMatrix(sObj,selectorArray)
            if(nargin<2)
                if(sObj.isMaskSet)
                    selectorArray=sObj.findIndFromDataMask;
                else
                    selectorArray=1:sObj.dimension;
                end
            end
            % Convert data to a standard matrix. 
            % The matrix is length(times)x dimension 
            dataMat=sObj.data(:,selectorArray);
        end
        function sOut = getSubSignal(sObj,identifier)
            if(isa(identifier,'cell'))
                if(isa(identifier{1},'char'))
                    sOut = sObj.getSubSignalFromNames(identifier);
                elseif(isa(identifier{1},'double'))
                    sOut = sObj.getSubSignalFromInd(identifier);
                else
                    error('Cells must contain strings!');
                end
            elseif(isa(identifier,'double'))
                sOut = sObj.getSubSignalFromInd(identifier);
            end
        end        
        function wSignal = getSigInTimeWindow(sObj,wMin,wMax)
            wSignal = sObj.copySignal;
            if(wMin<wSignal.minTime) 
                %if the window starts before the SignalObj pad with zeros
                %and set as new starttime
                wSignal.setMinTime(wMin);
            end
            if(wMax>wSignal.maxTime)
                %if wMax is too big, pad with zeros at end and set as new
                %end
                wSignal.setMaxTime(wMax); 
            end
            
            startIndex= wSignal.findNearestTimeIndex(wMin);
            endIndex  = wSignal.findNearestTimeIndex(wMax);
            wSignal.time=wSignal.time(startIndex:endIndex); wSignal.data=wSignal.data(startIndex:endIndex,:);
            wSignal.setMinTime;
            wSignal.setMaxTime;
        end        
        function sOut = getSubSignalFromInd(sObj, selectorArray)
            if(nargin<2)
                if(sObj.isDataMaskSet)
                    selectorArray=sObj.findIndFromDataMask;
                else
                    selectorArray=1:sObj.dimension;
                end
            end
            s3   = sObj.copySignal;
            time = s3.time;
            if(isa(selectorArray,'cell'))
                data=[];
               for i=1:length(selectorArray)
                   offset=0;
                   data = [data s3.data(:,selectorArray{i})];
                   for j=1:length(selectorArray{i})
                        dataLabels{offset + j} = s3.dataLabels{selectorArray{i}(j)};
                        if(~isempty(s3.plotProps))
                            plotProps{offset+ j} = s3.plotProps{selectorArray{i}(j)};
                        end
                   end
                   offset = offset + length(selectorArray{i});
               end
            else
                data = s3.data(:,selectorArray);
                dataLabels = cell(1,length(selectorArray));
                plotProps  = [];
                for i=1:length(selectorArray)
                    dataLabels{i}= s3.dataLabels{selectorArray(i)};
                    if(~isempty(s3.plotProps))
                        plotProps{i} = s3.plotProps{selectorArray(i)};
                    end
                end
            end
            
            
            

            name = s3.name;
            xlabelval = s3.xlabelval; xunits=s3.xunits; yunits = s3.yunits;
            sOut=SignalObj(time, data, name, xlabelval, xunits, yunits, dataLabels, plotProps);
            
        end
        function sOut = getSubSignalFromNames(sObj,labels)
            ind   = sObj.getIndicesFromLabels(labels);
            if(isa(ind,'cell'))
                if(length(ind)>1)
                    for i=1:length(ind)
                        s{i} = getSubSignalFromInd(ind{i});
                    end
                    sOut = s{1}.merge(s{2:end});
                else
                    sOut = sObj.getSubSignalFromInd(ind{1});
                end
            elseif(isa(ind,'double'))
                sOut  = sObj.getSubSignalFromInd(ind);
            end
        end
        
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %Plotting Functions
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %   plotProps: is a cell array with strings in each a entry. 
        %              The strings must evaluate to parameters that can be 
        %              passed to the standard matlab plot function.
        %   example: To plot a three dimensional signals with each line
        %   with specific properties (not the use of double quotes on the
        %   color entries so that the actual arguments have a quotes around
        %   them. 
        %
        % >> plotProps = {{' ''-.g'', ''LineWidth'' ,2'},...
        %                 {' ''k'', ''LineWidth'' ,2'},...
        %                 {' ''-.b'' '}};
        %
        %   selectorArrray: is either an numeric array indexing the
        %                   elements within the SignalObj data or a cell array
        %                   of characters that refers to the data elements
        %                   by their labels.
        % % 8-25-09 : Legend wont plot is SignalObj dimension >10;
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        function h=plot(sObj,selectorArray,plotProps,handle)
            if(nargin<4)
                handle=gca;
            end
           if(nargin<3)
              plotProps=sObj.plotProps;
           end
           if(nargin<2)
                if(sObj.isMaskSet)
                    selectorArray=sObj.findIndFromDataMask;
                    if(isempty(selectorArray))
                        h=[];
                        return;
                    end                        
                else
                    selectorArray=1:sObj.dimension;
                end
           end

           
            if(isa(selectorArray,'cell'))
                sArray = sObj.convertNamesToIndices(selectorArray);
            elseif(isa(selectorArray,'char'))
                sArray = sObj.convertNamesToIndices(selectorArray);
            elseif(isa(selectorArray,'double'))
                sArray = selectorArray;
            else
                error('selectorArray must contain either dataLabels or their indices');
            end
            
            

           if(length(plotProps)==length(sArray))
                for i=1:length(sArray)
                    sObj.setPlotProps(plotProps{i},sArray(i));
                end
           elseif(length(plotProps)<=length(sArray) && length(plotProps)==1)
               for i=1:length(sArray)
                    sObj.setPlotProps(plotProps,sArray(i));
               end
           end
           
           
              
          
            %If the dimensions of the data are larger than one can specify
            %the plot style for each dimension by placing their values in
            %an cell array.
            h=gcf;figure(h);
            if(nargin>=3)  %is we got called with parameter use those
                %sObj.setPlotProps(plotProps); %Only accepts entire cell of plotting properties as input
                %if(length(plotCell)>=length(sArray)) %if we specified plot parameters for each dimension
                for i=sArray
                    %plotStr=cell2str(plotCell{:,find(sArray==i)});
                    plotStr=cell2str(sObj.getPlotProps(i));
                    if(~strcmp(plotStr,'') && ~isempty(plotStr))
                        evalstring = strcat('h(',num2str(find(sArray==i)),')=plot(handle,sObj.time,sObj.data(:,',num2str(i),'),', plotStr,');');
                    else
                        evalstring = strcat('h(',num2str(find(sArray==i)),')=plot(handle,sObj.time,sObj.data(:,',num2str(i),'));');
                    end
                    %evalstring
                    eval(evalstring); hold on;
                end
            elseif(sObj.plotPropsSet) %% We use the values that have been set previously
                %plotCell = cell2str(sObj.getPlotProps(i));
                %fprintf('varargin is not empty')
                for i=sArray
                    plotStr =cell2str(sObj.getPlotProps(i));
                    %plotStr=cell2str(plotCell{:,1});
                    if(~strcmp(plotStr,'') && ~isempty(plotStr))
                        evalstring = strcat('h(',num2str(i),')=plot(handle,sObj.time,sObj.data(:,',num2str(i),'),', plotStr,');');
                    else
                        evalstring = strcat('h(',num2str(i),')=plot(handle,sObj.time,sObj.data(:,',num2str(i),'));');
                    end
                    %evalstring
                    eval(evalstring); hold on;
                end
            else %We didnt get any plotting properties. Use matlab default
                %plotCell{1} = '''';
                %fprintf('varargin is empty')
                h=plot(handle,sObj.time,sObj.data(:,sArray));
            end

            if(~strcmp(sObj.xunits,''))
                xunitsStr=strcat('\; [',sObj.xunits,']'); %\; is a large space in latex
            else
                xunitsStr='';
            end
            
            if(~strcmp(sObj.yunits,''))
                yunitsStr=strcat('\; [',sObj.yunits,']');
            else
                yunitsStr='';
            end
            
            if(strcmp(sObj.xlabelval,''))
                xlabel(strcat('$$',xunitsStr,'$$'),'Interpreter','latex');
                
            else                
%                 strcat(['$$' sObj.xlabelval xunitsStr '$$'])
                xlabel(strcat('$$',[sObj.xlabelval xunitsStr],'$$'),'Interpreter','latex');
                
            end
            if(~strcmp(sObj.name,''))
                if(~strcmp(yunitsStr,''))
                    %strcat('$$',sObj.name,yunitsStr,'$$')
                    ylabel(strcat('$$',[sObj.name yunitsStr],'$$'),'Interpreter','latex');
                    
                else
                    
                    ylabel(strcat('$$',sObj.name,'$$'),'Interpreter','latex');
                    %ylabel(sObj.name,'Interpreter','none');
                    
                end
            end
            
            if(~sObj.areDataLabelsEmpty && sObj.dimension<10)
                labelArray= cell(1,length(sArray));
                for i=1:length(sArray)
                    labelArray{i} = strcat('$$',sObj.dataLabels{sArray(i)},'$$');
                    
                end
                legend(labelArray,'Interpreter','latex');
            end
            axis tight;
        end        
        
        function h=plotVariability(sObj,linewidth,faceColor,ciUpper,ciLower)            
            if(nargin<3)
                faceColor='red';
            end
            if(nargin<3)
                linewidth=3;
            end
            if(nargin<2)                
                if(sObj.isMaskSet)
                    selectorArray=sObj.findIndFromDataMask;
                    if(isempty(selectorArray))
                        h=[];
                        return;
                    end                        
                else
                    selectorArray=1:sObj.dimension;
                end
            end

           
            if(isa(selectorArray,'cell'))
                sArray = sObj.convertNamesToIndices(selectorArray);
            elseif(isa(selectorArray,'char'))
                sArray = sObj.convertNamesToIndices(selectorArray);
            elseif(isa(selectorArray,'double'))
                sArray = selectorArray;
            else
                error('selectorArray must contain either dataLabels or their indices');
            end
            
            %Take the unique dataLabels and compute the variability of
            %these signals
            
            UniqueSigLabels = unique(sObj.getSubSignal(sArray).dataLabels);
                        
            
            for i=1:length(UniqueSigLabels)
                meanSig = mean(sObj.getSubSignal(UniqueSigLabels{i}),2);
                         
                if(nargin<4)
                    ci2=meanSig.data+std(meanSig.dataToMatrix);
                else
                    ci2=meanSig.data+ciUpper;
                end

                if(nargin<5)
                    ci1=meanSig.data-std(meanSig.dataToMatrix);
                else
                    ci1=meanSig.data+ciLower;
                end


                plot(sObj.time,meanSig.dataToMatrix,'k-','linewidth',linewidth);
                hold on;
                p=patch([reshape(sObj.time,[1 length(sObj.time)]) reshape(fliplr(sObj.time'),[1 length(sObj.time)])],...
                        [reshape(ci1',[1 length(sObj.time)])       reshape(fliplr(ci2'),[1,length(sObj.time)])],strcat('',faceColor{1},''));
                set(p,'facecolor',faceColor,'edgecolor','none');
                alpha(.5);
            end
        end
    end % public methods
        

        
        
end%classdef

% Helper function
function stringout=cell2str(input)
    if(isempty(input))
        stringout = '';
    else
        if(isa(input,'char'))
            stringout=input;
        elseif(isa(input,'cell'))
            stringout=cell2str(input{1});
        end
    end
end
##### SOURCE END #####
-->
   </body>
</html>