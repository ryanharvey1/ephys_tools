% new maze all approach:

% P0100
% 9/2/2011
% cur_rat = 'P0100';
% m1_data_path = '\\huxley.resrch.uleth.ca\EP\ppc-seq-lrng\P0100\RandomLights\2011-09-02_10-13-59_PPCp\TT\Analyses\ECDxHD\m1\60sStillCut';
% m2_data_path = '\\huxley.resrch.uleth.ca\EP\ppc-seq-lrng\P0100\RandomLights\2011-09-02_10-13-59_PPCp\TT\Analyses\ECDxHD\m2\60sStillCut';
% cur_sess = 3.02; %for sequence1
% TT18c14perm
% reduced_CueDirDataEgoByHDallTT_60sStillCut_45bins Sess
% TT18c14perm
% CueDirDataEgoByHDallTT_60sStillCut_45bins Sess

% 9/5/2011
cur_rat = 'P0100';
m1_data_path = '\\huxley.resrch.uleth.ca\EP\ppc-seq-lrng\P0100\RandomLights\2011-09-05_12-25-51PPCp\TT\Analyses\ECDxHD\m1\60sStillCut';
m2_data_path = '\\huxley.resrch.uleth.ca\EP\ppc-seq-lrng\P0100\RandomLights\2011-09-05_12-25-51PPCp\TT\Analyses\ECDxHD\m2\60sStillCut';
cur_sess = 3.04; %for sequence1
% m1
% reduced_CueDirDataEgoByHDallTT_60sStillCut_45bins
% CueDirDataEgoByHDallTT6c2bc_60sStillCut_45bins
% m2
% CueDirDataEgoByHDallTT_60sStillCut_45bins
% CueDirDataEgoByHDallTT6c2bc_60sStillCut_45bins

%----------------------------------------------------------------------------------------------------------------------------------------------------------------------
%P0662

% 8/16/2012
% cur_rat = 'P0662';
% m1_data_path = '\\huxley.resrch.uleth.ca\EP\ppc-seq-lrng\P0662\RandomLights_Sess3_xx\Data\2012-08-16_08-19-07_PPCp\TT\Analyses\ECDxHD\m1\60sStillCut';
% m2_data_path = '\\huxley.resrch.uleth.ca\EP\ppc-seq-lrng\P0662\RandomLights_Sess3_xx\Data\2012-08-16_08-19-07_PPCp\TT\Analyses\ECDxHD\m2\60sStillCut';
% cur_sess = 3.05; %for sequence1
%m1
% CueDirDataEgoByHDallTT_60sStillCut_45bins
% %m2
% CueDirDataEgoByHDallTT_60sStillCut_45bins

% 8/18/2012
cur_rat = 'P0662';
m1_data_path = '\\huxley.resrch.uleth.ca\EP\ppc-seq-lrng\P0662\RandomLights_Sess3_xx\Data\2012-08-18_09-23-41_M1_Onward_PPCp\TT\Analyses\ECDxHD\m1\60sStillCut';
m2_data_path = '\\huxley.resrch.uleth.ca\EP\ppc-seq-lrng\P0662\RandomLights_Sess3_xx\Data\2012-08-18_09-23-41_M1_Onward_PPCp\TT\Analyses\ECDxHD\m2\60sStillCut';
cur_sess = 3.07; %for sequence1
%m1
% CueDirDataEgoByHDallTT_60sStillCut_45bins
% 60sStillCutCueDirDataTT2c2bBin6M2
% CueDirDataEgoByHDTT2c2b_60sStillCut_45bins
% CueDirDataEgoByHDTT6c5bTOe2_60sStillCut_45bins
% %m2
% CueDirDataEgoByHDallTT_60sStillCut_45bins
% 60sStillCutCueDirDataTT2c2bBin6M1
% CueDirDataEgoByHDTT2c2b_60sStillCut_45bins
% CueDirDataEgoByHDTT6c5bTOe2_60sStillCut_45bins

% 8/20/2012
% cur_rat = 'P0662';
% m1_data_path = '\\huxley.resrch.uleth.ca\EP\ppc-seq-lrng\P0662\RandomLights_Sess3_xx\Data\2012-08-20_07-35-37_PPCp\TT\Analyses\ECDxHD\m1';
% m2_data_path = '\\huxley.resrch.uleth.ca\EP\ppc-seq-lrng\P0662\RandomLights_Sess3_xx\Data\2012-08-20_07-35-37_PPCp\TT\Analyses\ECDxHD\m2';
% cur_sess = 3.09; %for sequence1
% m1
% CueDirDataEgoByHDallTT_60sStillCut_45bins
% m2
% CueDirDataEgoByHDallTT_60sStillCut_45bins

% 8/21/2012
% cur_rat = 'P0662';
% m1_data_path = '\\huxley.resrch.uleth.ca\EP\ppc-seq-lrng\P0662\RandomLights_Sess3_xx\Data\2012-08-21_08-49-01_PPCp\TT\Analyses\ECDxHD\m1\60sStillCut';
% m2_data_path = '\\huxley.resrch.uleth.ca\EP\ppc-seq-lrng\P0662\RandomLights_Sess3_xx\Data\2012-08-21_08-49-01_PPCp\TT\Analyses\ECDxHD\m2\60sStillCut';
% cur_sess = 3.10; %for sequence1
% m1
% CueDirDataEgoByHDallTT_60sStillCut_45bins
% CueDirDataEgoByHDTT2c1b_60sStillCut_45bins
% m2
% reduced_CueDirDataEgoByHDallTT_60sStillCut_45bins

% 8/22/2012
% cur_rat = 'P0662';
% m1_data_path = '\\huxley.resrch.uleth.ca\EP\ppc-seq-lrng\P0662\RandomLights_Sess3_xx\Data\2012-08-23_07-51-24_PPCp\TT\Analyses\ECDxHD\60sStillCut\m1';
% m2_data_path = '\\huxley.resrch.uleth.ca\EP\ppc-seq-lrng\P0662\RandomLights_Sess3_xx\Data\2012-08-23_07-51-24_PPCp\TT\Analyses\ECDxHD\60sStillCut\m2';
% cur_sess = 3.12; %for sequence1
% m1
% reduced_CueDirDataEgoByHDallTT_60sStillCut_45bins
% m2
% CueDirDataEgoByHDallTT_60sStillCut_45bins

% 8/24/2012
% cur_rat = 'P0662';
% m1_data_path = '\\huxley.resrch.uleth.ca\EP\ppc-seq-lrng\P0662\RandomLights_Sess3_xx\Data\2012-08-24_08-04-48_PPCp\TT\Analyses\ECDxHD\60sStillCut\m1';
% m2_data_path = '\\huxley.resrch.uleth.ca\EP\ppc-seq-lrng\P0662\RandomLights_Sess3_xx\Data\2012-08-24_08-04-48_PPCp\TT\Analyses\ECDxHD\60sStillCut\m2';
% cur_sess = 3.13; %for sequence1
% m1
% CueDirDataEgoByHDallTT_60sStillCut_45bins
% m2
% CueDirDataEgoByHDallTT_60sStillCut_45bins

% 8/25/2012
% cur_rat = 'P0662';
% m1_data_path = '\\huxley.resrch.uleth.ca\EP\ppc-seq-lrng\P0662\RandomLights_Sess3_xx\Data\2012-08-25_07-36-40_PPCp\TT\Analyses\ECDxHD\m1\60sStillCut';
% m2_data_path = '\\huxley.resrch.uleth.ca\EP\ppc-seq-lrng\P0662\RandomLights_Sess3_xx\Data\2012-08-25_07-36-40_PPCp\TT\Analyses\ECDxHD\m2\60sStillCut';
% cur_sess = 3.14; %for sequence1
%60sStillCut
% cur_rat = 'P0662';
% m1_data_path = '\\huxley.resrch.uleth.ca\EP\ppc-seq-lrng\P0662\RandomLights_Sess3_xx\Data\2012-08-25_07-36-40_PPCp\TT\Analyses\ECDxHD\m1\60sStillCut';
% m2_data_path = '\\huxley.resrch.uleth.ca\EP\ppc-seq-lrng\P0662\RandomLights_Sess3_xx\Data\2012-08-25_07-36-40_PPCp\TT\Analyses\ECDxHD\m2\60sStillCut';
% cur_sess = 3.14; %for sequence1
% m1
% reduced_CueDirDataEgoByHDallTT_60sStillCut_45bins
% CueDirDataEgoByHDTT2c9b15b_60sStillCut_45bins

% m2
% CueDirDataEgoByHDallTT_60sStillCut_45bins
% CueDirDataEgoByHDTT2c9b15b_60sStillCut_45bins

% 8/29/2012
% cur_rat = 'P0662';
% m1_data_path = '\\huxley.resrch.uleth.ca\EP\ppc-seq-lrng\P0662\RandomLights_Sess3_xx\Data\2012-08-29_07-24-22_PPCp\TT\Analyses\ECDxHD\m1\60sStillCut';
% m2_data_path = '\\huxley.resrch.uleth.ca\EP\ppc-seq-lrng\P0662\RandomLights_Sess3_xx\Data\2012-08-29_07-24-22_PPCp\TT\Analyses\ECDxHD\m2\60sStillCut';
% cur_sess = 3.18; %for sequence1
% m1
% CueDirDataEgoByHDallTT_60sStillCut_45bins
% m2
% reduced_CueDirDataEgoByHDallTT_60sStillCut_45bins

% 9/1/2012
% cur_rat = 'P0662';
% m1_data_path = '\\huxley.resrch.uleth.ca\EP\ppc-seq-lrng\P0662\RandomLights_Sess3_xx\Data\2012-09-01_07-23-45_PPCp\TT\Analyses\ECDxHD\m1\60sStillCut';
% m2_data_path = '\\huxley.resrch.uleth.ca\EP\ppc-seq-lrng\P0662\RandomLights_Sess3_xx\Data\2012-09-01_07-23-45_PPCp\TT\Analyses\ECDxHD\m2\60sStillCut';
% cur_sess = 3.21; %for sequence1
% % m1
% CueDirDataEgoByHDallTT_60sStillCut_45bins
% CueDirDataEgoByHDTT15c1b5b6b_60sStillCut_45bins
% m2
% reduced_CueDirDataEgoByHDallTT_60sStillCut_45bins
% CueDirDataEgoByHDTT15c1b5b6b_60sStillCut_45bins

% 9/4/2012
% cur_rat = 'P0662';
% m1_data_path = '\\huxley.resrch.uleth.ca\EP\ppc-seq-lrng\P0662\RandomLights_Sess3_xx\Data\2012-09-04_07-27-36_PPCp\TT\Analyses\ECDxHD\bin45\60sStillCut\m1';
% m2_data_path = '\\huxley.resrch.uleth.ca\EP\ppc-seq-lrng\P0662\RandomLights_Sess3_xx\Data\2012-09-04_07-27-36_PPCp\TT\Analyses\ECDxHD\bin45\60sStillCut\m2';
% cur_sess = 3.24; %for sequence1
% m1
% reduced_CueDirDataEgoByHDallTT_60sStillCut_45bins
% m2
% CueDirDataEgoByHDallTT_60sStillCut_45bins

% 9/5/2012
% cur_rat = 'P0662';
% m1_data_path = '\\huxley.resrch.uleth.ca\EP\ppc-seq-lrng\P0662\RandomLights_Sess3_xx\Data\2012-09-05_07-26-10_PPCp\TT\Analyses\ECDxHD\m1';
% m2_data_path = '\\huxley.resrch.uleth.ca\EP\ppc-seq-lrng\P0662\RandomLights_Sess3_xx\Data\2012-09-05_07-26-10_PPCp\TT\Analyses\ECDxHD\m2';
% cur_sess = 3.25; %for sequence1
% m1
% reduced_CueDirDataEgoByHDallTT_60sStillCut_45bins
% m2
% CueDirDataEgoByHDallTT_60sStillCut_45bins

%HD OPTIONS:  
%Note this is actually Egocentric Cue Direction Bin Size:
HDBinSize = 45;
%These are the HD bins:
hdQDlist = [0; 45; 90; 135; 180; 225; 270; 315; 359]; %note first bin will be short by 1 deg because 0 HD values are contaminated.
disp(['Using HD Bin Size of ' int2str(HDBinSize) ' degrees.']);

%smooth param
smooth_flag = 0;
SD = 1;
npts = 2;

cache_file = ['CueDirDataEgoByHDallTT_60sStillCut_45bins' cur_rat 'M1_Sess' num2str(cur_sess, '%03d') '.mat'];
if exist([m1_data_path  '\' cache_file], 'file')
  disp(['Loading ' [m1_data_path  '\' cache_file]]);
  load([m1_data_path  '\' cache_file]); 
else
  disp(['Cache file not found: ' cache_file ' -- Data set skipped']);
end;
clear cache_file
cdBinnedM1 = cdBinned;
cdListM1 = cdlist;
clear cdBinned cdlist

cache_file = ['CueDirDataEgoByHDallTT_60sStillCut_45bins' cur_rat 'M2_Sess' num2str(cur_sess, '%03d') '.mat'];
if exist([m2_data_path  '\' cache_file], 'file')
  disp(['Loading ' [m2_data_path  '\' cache_file]]);
  load([m2_data_path  '\' cache_file]); 
else
  disp(['Cache file not found: ' cache_file ' -- Data set skipped']);
end;
clear cache_file
cdBinnedM2 = cdBinned;
cdListM2 = cdlist;
clear cdBinned

%combine cdBinnedDataM1+M2
% cdBinnedMall = cdBinnedM1 + cdBinnedM2;
% cdBinnedMall(:,1) = cdBinnedM1(:,1);
% cdBinned = cdBinnedMall;
% cdBinned(:,3:end) = cdBinned(:,3:end)/2;

cdListMall = cdListM1 + cdListM2;
cdlist = cdListMall;

disp('Binning Data...')
% -2 then plus 2 for length because last row two rows for Cue Dir 950-no
% Cue and 1050-lost HD and this value must be removed 
% for the # rows calculation then put back in
m = size(hdQDlist,1);
m = m-1;
[row ~] = size(hdQDlist);

if cur_sess == 1000000
    cdBinned = zeros(((size(cdlist,1)-2)/HDBinSize)+2,(2),m);
else
    cdBinned = zeros(((size(cdlist,1)-2)/HDBinSize)+2,(n_cells+2),m);
end %if cur_sess
%label this way fist to make binning easier then relabel below after binning
for i = 1:m
    cdBinned(1:end-2,1,i) = HDBinSize:HDBinSize:360;
end
clear i
cdBinned(end-1:end,1,1) = [950 1050];
% length-2 because last 2 rows needs to be treated differently b/c 950/1050 coding:
for i = 1:(size(cdBinned,1)-2) 
    for l = 1:m %for each HD bin
        if i > 1
            %NOTE THIS METHOD COPIED FROM HD SCRIPT SHOULD WORK BECAUSE cdlist
            %ROW NUMBERS STILL REPRESENT 0 TO 360 DEGREES EVEN THOUGH VALUES IN
            %ROWS ARE ORDERED -180 TO 179
            % sum across binwidth and convert to microseconds to seconds
            cdBinned(i,2,l) = sum(cdlist((cdBinned(i-1,1,l)+1):cdBinned(i,1,l),2,l))/1e6;
            if cur_sess < 1000000
                for j = 1:n_cells
                    %for each cell count spikes across bin and divide by seconds to
                    %convert to firing rate in spikes/s
                    cdBinned(i,2+j,l) = sum(cdlist((cdBinned(i-1,1,l)+1):cdBinned(i,1,m),2+j,l))/cdBinned(i,2,l);
                end % for j   
                clear j
            end %if cur_sess
        else %formula slightly diff for first row, probably can figure out how to get rid of this at some point:
            cdBinned(1,2,l) = sum(cdlist(1:HDBinSize,2,l))/1e6;
            if cur_sess < 1000000
                for j = 1:n_cells
                    cdBinned(1,2+j,l) = sum(cdlist(1:HDBinSize,2+j,l))/cdBinned(1,2,l);
                end % for j   
                clear j
            end %if cur_sess
        end %if i 
    end % for l
end          

% Because last bin is coding HD450, i.e., a single "degree" and this needs to be treated separately:  
for k = 1:2
    cdBinned(i+1:i+2,1) = cdlist(end-1:end,1,1); % copy labels
    cdBinned(i+1,2,1) = cdlist(end-1,2,1)/1e6; %convert duration to sec
    cdBinned(i+2,2,1) = cdlist(end,2,1)/1e6; %convert duration to sec
    if cur_sess < 1000000
        cdBinnedFR = zeros(n_cells,1,1);
        cdlistFR = zeros(n_cells,1,1);
        for j = 1:n_cells
            %divide # spikes in this category by seconds to convert to firing rate in spikes/s
             cdBinned(i+1,2+j,1) = cdlist(end-1,2+j,1)/cdBinned(i+1,2,1);
             cdBinned(i+2,2+j,1) = cdlist(end,2+j,1)/cdBinned(i+2,2,1);
             %computing average firing rate for cells for cdlist and cdBinned and make sure they agree:
             %don't include 950 or 1050 so this info will also be useful:
             cdBinnedFR(j) = 0;
             for n = 1:m
                 cdBinnedSpikes_temp = cdBinned(1:end-2,2+j,n).*cdBinned(1:end-2,2,n);
                 cdBinnedFR(j) = cdBinnedFR(j) + sum(cdBinnedSpikes_temp(1:end));
                 clear cdBinnedSpikes_temp
             end %for n
             clear n
             %don'g include 950 or 1050 AND skip 1st bin (binned) also not I reverted to spikes not FR so label is not accurate:
             cdlistFR(j) = 0;
             for count = 1:row-1
                cdlistFR(j) = cdlistFR(j) + sum(cdlist(1:end-2,2+j,count));
             end
             if k == 2
% moved this to below because was still getting displayed 2x
             end
        end % for j  
        clear j
    end %if cur_sess
end % for k
clear i k l n row

for j = 1:n_cells
         disp(['Make sure #spikes matches for cdlist (by degree): ' int2str(cdlistFR(j)) ...
         ' vs cdBinned data: ' int2str(cdBinnedFR(j))]);
end % for j  
clear j

% Apply appropriate row labels/Replace 0-360 labels used for binning:
for i = 1:m
    cdBinned(1:end-2,1,i) = -180:HDBinSize:(180-HDBinSize);
end
clear i 

%Display Some Data Checks
if cur_sess < 1000000
%     %NOTE HERE UNLIKE WITH #SPIKES LIST VS BINNED 950 AND 1050 CODING IS
%     DataChecks.cdBinned.CumOccupancySec = 0;
%     DataChecks.cdlist.CumOccupancySec = 0;
%     %INCLUDED:
%     for i = 1:m
%         DataChecks.cdBinned.CumOccupancySec = DataChecks.cdBinned.CumOccupancySec + sum(cdBinned(1:end,2,i));
%         DataChecks.cdlist.CumOccupancySec = DataChecks.cdlist.CumOccupancySec + sum(cdlist(1:end,2,i))/1e6;
%     end
%     DataChecks.cdlist.CumOccupancyMin = DataChecks.cdlist.CumOccupancySec/60;
%     DataChecks.cdBinned.CumOccupancyMin = DataChecks.cdBinned.CumOccupancySec/60;
%     DataChecks.binVsList.CumOccupDifSec = DataChecks.cdlist.CumOccupancySec - DataChecks.cdBinned.CumOccupancySec;
%     DataChecks.UnaccountedSec.NineFifty = cdlist(end-1,2)/1e6;
%     DataChecks.UnaccountedSec.TenFifty = cdlist(end,2)/1e6;
%     DataChecks.UnaccountedSec.Total = DataChecks.UnaccountedSec.NineFifty + DataChecks.UnaccountedSec.TenFifty;
%     DataChecks.PVsessiontimeminMinUnused = DataChecks.PVsessiontimemin - DataChecks.UnaccountedSec.Total/60;
%     DataChecks.UnaccountedSec.PropHDlost = (DataChecks.UnaccountedSec.TenFifty/DataChecks.cdlist.CumOccupancySec)*100;
%     disp(['Make sure total session times including 950s and 1050s match: ' int2str(DataChecks.cdlist.CumOccupancyMin) ...
%     ' for cue direction by degree list vs ' int2str(DataChecks.cdBinned.CumOccupancyMin) ...
%     ' for binned vs ' int2str(DataChecks.PVsessiontimemin) ' in pv_data.']);
%     disp(['Head Direction Lost: ' int2str(DataChecks.UnaccountedSec.PropHDlost) ' Percent of time.']);
%     disp(['Cue direction coded as 950 for ' int2str(DataChecks.UnaccountedSec.NineFifty) ' seconds.']);    
end %if cur_sess < 1000000

% close any figures open from last run        
close all
row_end = size(cdBinned,1)-2;

%THIS ISN'T ACTUALLY WORKING YET FOR THESE DATA SETS:
% %Print Figures to .jpeg file:
% fh1 = gcf;
% line(cdBinned(1:row_end,1),cdBinned(1:row_end,2))
% box off
% % Create xlabel
% xlabel('Degrees','FontSize',30);
% % Create ylabel
% ylabel('Seconds');
% title('Egocentric Cue Direction Occupancy','FontSize',30);
% xlim([-185 180]);
% print(fh1, '-djpeg', 'CueDirOccupancy');
rYstrct = [];
oX = [];
if cur_sess < 1000000
    if smooth_flag == 0
            for i = 12%1:n_cells 
              for j = 1:m               
                % Create axes
                %get neuron name
        %          if i < 2
                    [~, name] = fileparts(tfile_list{i});
                    newname = name;
                    newname(newname=='_') = '-';
        %         else
        %             newname = 'fakeCell2';
        %         end
        %       Columns are HD
                plot_matrix(:,j) = (cdBinned(1:row_end,i+2,j));
                plot_matrix_all{i}(:,j) = (cdBinned(1:row_end,i+2,j));
                rYstrct(size(rYstrct,1)+1:size(rYstrct,1)+row_end,i) = cdBinned(1:row_end,i+2,j);
                if i == 12
                    oX(length(oX)+1:length(oX)+row_end,1) = cdBinned(1:row_end,2,j);
                end
              end %for j  
                fh2 = figure;
                axes1 = axes('Parent',fh2,...
                'YTickLabel',{'-180','-135','-90','-15','0','15','90','135','180'},...
                'YTick',[1 2 3 4 5 6 7 8 9],...
                'YDir','reverse',...
                'XTickLabel',{'0','45','90','135','180','225','270','315','360'},...
                'XTick',[1 2 3 4 5 6 7 8 9],...
                'FontSize',30,...
                'FontName','Arial');
                box(axes1,'on');
                hold on;
                plot_matrix(m+1,1:m+1) = 0;
                pcolor(plot_matrix)
                % Create xlabel
                ylabel('Egocentric Cue Direction (Degrees)','FontSize',30);
                % Create ylabel
                xlabel('Head Direction(Degrees)','FontSize',30');
                colorbar
                xlim([1 m+1]);
                ylim([1 m+1]);
                title(newname,'FontSize',30);      
                print(fh2, '-djpeg', newname);
                hold off
                 clear plot_matrix fh2
            end %for i
            clear i j m newname fh1 name  row_end p
       pX = oX./(sum(oX));
    else
       for i = 1:n_cells 
          for j = 1:m               
            % Create axes
            %get neuron name
    %          if i < 2
                [~, name] = fileparts(tfile_list{i});
                newname = name;
                newname(newname=='_') = '-';
    %         else
    %             newname = 'fakeCell2';
    %         end
    %       Columns are HD
            plot_matrix(:,j) = (cdBinned(1:row_end,i+2,j));
            plot_vector(length(rY)+1:length(rY)+row_end,i) = cdBinned(1:row_end,i+2,j);
          end %for j  
            [rw clmn] = size(plot_matrix);
            plot_matrix_smooth = [plot_matrix plot_matrix plot_matrix; plot_matrix plot_matrix plot_matrix; plot_matrix plot_matrix plot_matrix];
            plot_matrix_smooth = smooth(plot_matrix_smooth, SD, npts, SD, npts); 
            plot_matrix = plot_matrix_smooth(rw+1:rw+rw+1,clmn+1:clmn+clmn+1);
            max_fr(i) = max(max(plot_matrix));
            max_fr_matrix(1:length(plot_matrix),1:length(plot_matrix))=max_fr(i);
            plot_matrix = plot_matrix./max_fr_matrix;
            fh2 = figure;
            axes1 = axes('Parent',fh2,...
            'YTickLabel',{'-180','-135','-90','-45','0','45','90','135','180'},...
            'YTick',[1:m+1],...
            'YDir','reverse',...
            'XTickLabel',{'0','45','90','135','180','225','270','315','360'},...
            'XTick',[1:m+1],...
            'FontSize',30,...
            'FontName','Arial');
        % bin 45 axes labels
    %         'XTickLabel',{'0','45','90','135','180','225','270','315','360'},...
    %         'YTickLabel',{'-180','-135','-90','-45','0','45','90','135','180'},...
    % %bin30 axes labels:
    %         'YTickLabel',{'-180','-150','-120','-90','-60','-30','0','30','60','90','120','150','180'},...
    %         'XTickLabel',{'0','30','60','90','120','150','180','210','240','270','300','330','360'},...
            box(axes1,'on');
            hold on;
            plot_matrix(m,1:m+1) = 0;
            pcolor(plot_matrix)
            
            % Create xlabel
            ylabel('Egocentric Cue Direction (Degrees)','FontSize',30);
            % Create ylabel
            xlabel('Head Direction(Degrees)','FontSize',30');
            colorbar
            xlim([1 m+1]);
            ylim([1 m]);
            title(newname,'FontSize',30);      
            print(fh2, '-djpeg', newname);
            hold off
            clear plot_matrix fh2 max_fr_matrix
       end %for i
    end
    clear i j m newname fh1 name  row_end p
%     filename = [data_path 'CueDirDataEgoByHDm2allTTs45bins' num2str(rat.id) 'sess' num2str(cur_sess, '%03d') '.mat'];
%     disp(['saving data to file: ' filename]);
%     eval(['save ' filename ' n_cells hdQDlist tfile_list cdlist cdBinned spike_data time epoch_times pv_data']);
end %if cur_sess < 1000000

rY{1} = rYstrct(:,12);
[IpS,IpSmat] = InformationPerSpike(rY,pX);

diary off; 